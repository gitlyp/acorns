{"componentChunkName":"component---node-modules-suziwen-gatsby-theme-sculpting-src-templates-template-blog-post-js","path":"/cjting/how-http-basic-auth-work","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://suziwen.github.io/acorns"}},"storyWriterMarkdown":{"id":"be62b608-d8a1-5a57-8428-737cb579cfd6","html":"\n\n\t<div class=\"preview html_preview xsj_export_zip\"><div style=\"overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; display: none;\"><svg style=\"display: none;\"><defs id=\"MathJax_SVG_glyphs\"/><defs xmlns=\"http://www.w3.org/2000/svg\"><filter xmlns=\"http://www.w3.org/2000/svg\" id=\"dropshadow\" height=\"130%\">      <fegaussianblur in=\"SourceAlpha\" stddeviation=\"3\"/>       <feoffset dx=\"2\" dy=\"2\" result=\"offsetblur\"/>       <femerge>         <femergenode/>        <femergenode in=\"SourceGraphic\"/>       </femerge>    </filter><filter id=\"editing-stripe-bk\" filterunits=\"userSpaceOnUse\" x=\"-100%\" y=\"-100%\" width=\"300%\" height=\"300%\"><feflood flood-color=\"#700f0f\" result=\"flood1\"/><feflood flood-color=\"#fff\" flood-opacity=\"0.5\" result=\"flood2\"/><feimage xlink:href=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAwcHgiIGhlaWdodD0iMTAwMHB4Ij48ZGVmcz48cGF0dGVybiBpZD0icGF0dGVybiIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeD0iMCIgeT0iMCIgd2lkdGg9IjQiIGhlaWdodD0iNCI+PHBhdGggZD0iTSAtNCAtNCBMIDggOCBNIC04IC00IEwgNCA4IE0gLTQgLTggTCA4IDQiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI3BhdHRlcm4pIi8+PC9zdmc+\" x=\"0\" y=\"0\" width=\"2000\" height=\"1000\" result=\"image\"/><fetile in=\"image\" result=\"tile\"/><fecomposite operator=\"in\" in=\"flood1\" in2=\"tile\" result=\"tile2\"/><fegaussianblur in=\"SourceAlpha\" stddeviation=\"10\" result=\"blur\"/><fecomposite operator=\"in\" in=\"tile2\" in2=\"blur\" result=\"cloud\"/><femorphology operator=\"dilate\" radius=\"2\" in=\"SourceAlpha\" result=\"dilate\"/><fecomposite operator=\"in\" in=\"flood2\" in2=\"dilate\" result=\"base\"/><femerge><femergenode in=\"cloud\"/><femergenode in=\"base\"/><femergenode in=\"SourceGraphic\"/></femerge></filter></defs></svg></div><blockquote class=\"markdown_blockquote\">\n<p class=\"xsj_paragraph xsj_paragraph_level_1\"><span class=\"xsj_placeholder_span\"></span>本文为转载文章,如果涉及侵权,请联系 <a href=\"mailto:suziwen1@gmail.com\" class=\"xsj_link xsj_auto_link\">suziwen1@gmail.com</a>,会第一时间删除</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_1\"><span class=\"xsj_placeholder_span\"></span>转载自: <a href=\"https://cjting.me/2018/03/31/how-http-basic-auth-work/\" class=\"xsj_link xsj_auto_link\">https://cjting.me/2018/03/31/how-http-basic-auth-work/</a></p>\n</blockquote>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\"></p><div class=\"toc mindmap_toc mindmap_container\" data-hash=\"977fcf4608307796747c8412f6411976_mindmap_toc\"><div class=\"xsj_mindmap xsj_mindmap_toc\"><svg id=\"xsj_mindmap_toc_1587196664717\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" class=\"xsj_svg_viewbox\" style=\"max-width:925px;max-height:311px;\" viewbox=\"0 0 925 311\" width=\"100%\" height=\"100%\"><g transform=\"translate(402.5,177.5) scale(1)\"><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#dc3912\" stroke-width=\"4\" d=\"M166.5,-40.5 L171.5,-40.5 C243.5,-40.5 238.5,40.5 274.5,40.5 L276.5,40.5\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(166.5, -40.5)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: white;\"/><g transform=\"translate(274.5,40.5)\"><path class=\"markmap-node-path\" d=\"M0,0L199,0\" stroke-width=\"4\" stroke=\"#dc3912\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(199, 0)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: rgb(220, 57, 18);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#ff9900\" stroke-width=\"4\" d=\"M166.5,-40.5 L171.5,-40.5 C243.5,-40.5 238.5,-40.5 274.5,-40.5 L276.5,-40.5\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(166.5, -40.5)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: white;\"/><g transform=\"translate(274.5,-40.5)\"><path class=\"markmap-node-path\" d=\"M0,0L58,0\" stroke-width=\"4\" stroke=\"#ff9900\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(58, 0)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: rgb(255, 153, 0);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"4\" d=\"M166.5,-40.5 L171.5,-40.5 C243.5,-40.5 238.5,-121.5 274.5,-121.5 L276.5,-121.5\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(166.5, -40.5)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: white;\"/><g transform=\"translate(274.5,-121.5)\"><path class=\"markmap-node-path\" d=\"M0,0L39,0\" stroke-width=\"4\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(39, 0)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-node markmap-root-node\" transform=\"translate(-310.5,-40.5)\"><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(476, 0)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: rgb(51, 102, 204);\"/><g transform=\"translate(1, -36)\"><rect class=\"markmap-node-rect\" rx=\"10\" ry=\"10\" height=\"72\" width=\"475\" fill=\"rgb(78, 156, 255)\" stroke=\"#3366cc\" stroke-width=\"1\"/><text class=\"markmap-node-text\" alignment-baseline=\"middle\" x=\"238.5\" y=\"46\" text-anchor=\"middle\" style=\"font: bolder 30px sans-serif; fill-opacity: 1; fill: rgb(255, 255, 255);\">HTTP Basic Auth 是怎么样工作的</text></g></g><g class=\"markmap-node\" transform=\"translate(274.5,40.5)\"><a xlink:href=\"#e5a682e4bd95e6b885e999a4e794a8e688b7e5908de5928ce5af86e7a081_3\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(220, 57, 18); stroke: white; stroke-width: 2px; cursor: pointer;\">如何清除用户名和密码</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(220, 57, 18); cursor: pointer;\">如何清除用户名和密码</text></a></g><g class=\"markmap-node\" transform=\"translate(274.5,-40.5)\"><a xlink:href=\"#realm_2\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(255, 153, 0); stroke: white; stroke-width: 2px; cursor: pointer;\">Realm</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(255, 153, 0); cursor: pointer;\">Realm</text></a></g><g class=\"markmap-node\" transform=\"translate(274.5,-121.5)\"><a xlink:href=\"#e6b581e7a88b_1\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px; cursor: pointer;\">流程</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(51, 102, 204); cursor: pointer;\">流程</text></a></g><g class=\"annotation-group\"><g class=\"annotations\"/></g></g></svg></div></div><p></p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\"><code>HTTP Basic Auth</code> 是 HTTP 提供的一种验证方式，因为明文传输用户名和密码，非 HTTPS 环境下很不安全，一般用的非常少。但是在某些情况下用一用还是非常方便的，比如，一些静态站点例如文档系统可以使用 HTTP Basic Auth 进行简单的权限验证。</p>\n<!--more-->\n<h2 class=\"xsj_heading_hash xsj_heading xsj_heading_h2\" id=\"e6b581e7a88b_1\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"e6b581e7a88b_1\" class=\"blank_anchor_name\"></a><a id=\"e6b581e7a88b_1\" class=\"blank_anchor_id\"></a><a name=\"流程\" class=\"blank_anchor_name\"></a><a id=\"流程\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">流程</span></h2>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">HTTP Basic Auth 使用两个 HTTP Header 实现，分别是 <code>WWW-Authenticate</code> 和 <code>Authorization</code>。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">流程如下：</p>\n<ol class=\"markdown_ol\">\n<li><span class=\"xsj_placeholder_span\"></span>客户端请求服务器页面，服务器返回 <code>401</code> 以及 <code>WWW-Authenticate: Basic realm=\"site\"</code>。</li>\n<li><span class=\"xsj_placeholder_span\"></span>浏览器弹出对话框，提示用户输入用户名和密码。</li>\n<li><span class=\"xsj_placeholder_span\"></span>浏览器再次请求页面，携带 <code>Authorization: Basic &lt;str&gt;</code>，其中，<code>str=base64(username:password)</code>。</li>\n<li><span class=\"xsj_placeholder_span\"></span>服务器返回正常页面。</li>\n</ol>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">base64 只是一个编码过程，而不是加密过程，因此，HTTP Basic Auth 是在明文传输用户名和密码，中间设备很容易通过检查数据包获取用户名和密码。</p>\n<h2 class=\"xsj_heading_hash xsj_heading xsj_heading_h2\" id=\"realm_2\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"realm_2\" class=\"blank_anchor_name\"></a><a id=\"realm_2\" class=\"blank_anchor_id\"></a><a name=\"realm\" class=\"blank_anchor_name\"></a><a id=\"realm\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Realm</span></h2>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">我们可以发现，<code>WWW-Authenticate</code> 这个头携带了一个 <code>realm</code> 属性，这个属性用来标注页面所属的区域，具体定义见 <a href=\"https://tools.ietf.org/html/rfc7235#section-2.2\" class=\"xsj_link xsj_manu_link\">RFC 7235</a>。一般情况下不用在意，随便填写或者不填写都可以。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">但是，如果你的网站有两个子目录，每个子目录有自己的用户名和密码的话，<code>realm</code> 属性就比较重要了，这个属性会影响浏览器的密码自动填充过程。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">我们知道，访问一个 HTTP Basic Auth 的网站，第一次输入密码以后，之后访问就不再需要输入密码了，这是因为浏览器缓存了用户名和密码并且自动替我们填充了。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">关于浏览器在 HTTP Basic Auth 时的密码填充算法，我没有找到明确的描述，自己基于 Chrome 做了一些实验，总结如下。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">考虑下面的网站，有两个 URL，每个 URL 的用户名和密码不相同。</p>\n<ul class=\"markdown_ul\">\n<li><code>/a</code>: <code>username: a, password: a, realm: whatever</code></li>\n<li><code>/b</code>: <code>username: b, password b, realm: whatever</code></li>\n</ul>\n<ol class=\"markdown_ol\">\n<li><span class=\"xsj_placeholder_span\"></span>用户访问 <code>/a</code>，浏览器提示输密码，成功进入，浏览器将密码和 <code>realm=whatever</code> 关联</li>\n<li><span class=\"xsj_placeholder_span\"></span>用户访问 <code>/b</code>，浏览器请求，发现 401，同时 <code>realm=whatever</code>，默认使用上一次输入的密码填充</li>\n<li><span class=\"xsj_placeholder_span\"></span>还是 401，浏览器弹框提示用户输入，然后更新 <code>realm=whatever</code> 的密码关联</li>\n<li><span class=\"xsj_placeholder_span\"></span>用户访问 <code>/a</code>，浏览器自动使用 <code>realm=whatever</code>的密码进行填充（应该是缓存了相关信息，知道 <code>/a</code> 需要密码），收到 401，弹框提示用户输入，更新 <code>realm=whatever</code> 的密码关联</li>\n<li><span class=\"xsj_placeholder_span\"></span>用户访问 <code>/b</code>，和上面的流程一样，还是会导致弹框提示用户输入用户名和密码</li>\n</ol>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">也就是说，如果两个子目录的用户名和密码不一样，但是 <code>realm</code> 一样的话，会导致在两个子目录进行切换时，不停地输入用户民和密码。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">如果 <code>realm</code> 不一样的话，就没有这个问题了，因为浏览器使用 <code>realm</code> 来关联用户名和密码。</p>\n<h2 class=\"xsj_heading_hash xsj_heading xsj_heading_h2\" id=\"e5a682e4bd95e6b885e999a4e794a8e688b7e5908de5928ce5af86e7a081_3\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"e5a682e4bd95e6b885e999a4e794a8e688b7e5908de5928ce5af86e7a081_3\" class=\"blank_anchor_name\"></a><a id=\"e5a682e4bd95e6b885e999a4e794a8e688b7e5908de5928ce5af86e7a081_3\" class=\"blank_anchor_id\"></a><a name=\"如何清除用户名和密码\" class=\"blank_anchor_name\"></a><a id=\"如何清除用户名和密码\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">如何清除用户名和密码</span></h2>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">因为浏览器会记住用户名和密码，然后替我们做“自动登录”，那么该怎么样才能“登出”呢？</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">考虑这样一个场景，网站设置了多套用户名和密码，下发了部分给客户，结果客户反应说用户名和密码不对，那么此时，因为我已经登录成功了，无法再看到输入框，自然也无法测试。这个时候我们需要就是“登出”，清空浏览器的 “HTTP Basic Auth 缓存”。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">在 Chrome 中，我们只要在 URL 前面加上 <code>user@</code> 即可强制浏览器刷新它的缓存，弹出对话框。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">例如，网站为 <code>http://www.a.com</code>，访问输入了密码以后，再使用 <code>http://user@www.a.com</code> 访问，就会重新弹出弹框。</p>\n</div>\n\n","excerpt":"HTTP Basic Auth 是 HTTP 提供的一种验证方式，因为明文传输用户名和密码，非 HTTPS 环境下很不安全，一般用的非常少。但是在某些情况下用一用还是非常方便的，比如，一些静态站点例如文档系统可以使用 HTTP Basic Auth 进行简单的权限验证。\nHTTP...","docType":"posts","slug":"cjting/how-http-basic-auth-work","title":"HTTP Basic Auth 是怎么样工作的","customCss":"","createDate":"April 10, 2020","updateDate":"April 18, 2020","tags":["文章","转载","技术","http","auth"]}},"pageContext":{"slug":"cjting/how-http-basic-auth-work","prev":{"title":"JavaScript 与 Unicode","docType":"posts","slug":"cjting/js-and-unicode"},"next":{"title":"RSA 的原理与实现","docType":"posts","slug":"cjting/rsa"},"pluginOptions":{"tagsPath":"/tags/","archivesPath":"/archives/","basePath":"/","commentType":"gitalk"},"basePath":"/"}}}