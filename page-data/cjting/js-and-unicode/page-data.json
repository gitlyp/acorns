{"componentChunkName":"component---node-modules-suziwen-gatsby-theme-sculpting-src-templates-template-blog-post-js","path":"/cjting/js-and-unicode","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://suziwen.github.io/acorns"}},"storyWriterMarkdown":{"id":"e9f92b23-6470-5515-8355-3610a9a3106c","html":"\n\n\t<div class=\"preview html_preview xsj_export_zip\"><div style=\"overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; display: none;\"><svg style=\"display: none;\"><defs id=\"MathJax_SVG_glyphs\"/><defs xmlns=\"http://www.w3.org/2000/svg\"><filter xmlns=\"http://www.w3.org/2000/svg\" id=\"dropshadow\" height=\"130%\">      <fegaussianblur in=\"SourceAlpha\" stddeviation=\"3\"/>       <feoffset dx=\"2\" dy=\"2\" result=\"offsetblur\"/>       <femerge>         <femergenode/>        <femergenode in=\"SourceGraphic\"/>       </femerge>    </filter><filter id=\"editing-stripe-bk\" filterunits=\"userSpaceOnUse\" x=\"-100%\" y=\"-100%\" width=\"300%\" height=\"300%\"><feflood flood-color=\"#700f0f\" result=\"flood1\"/><feflood flood-color=\"#fff\" flood-opacity=\"0.5\" result=\"flood2\"/><feimage xlink:href=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAwcHgiIGhlaWdodD0iMTAwMHB4Ij48ZGVmcz48cGF0dGVybiBpZD0icGF0dGVybiIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeD0iMCIgeT0iMCIgd2lkdGg9IjQiIGhlaWdodD0iNCI+PHBhdGggZD0iTSAtNCAtNCBMIDggOCBNIC04IC00IEwgNCA4IE0gLTQgLTggTCA4IDQiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI3BhdHRlcm4pIi8+PC9zdmc+\" x=\"0\" y=\"0\" width=\"2000\" height=\"1000\" result=\"image\"/><fetile in=\"image\" result=\"tile\"/><fecomposite operator=\"in\" in=\"flood1\" in2=\"tile\" result=\"tile2\"/><fegaussianblur in=\"SourceAlpha\" stddeviation=\"10\" result=\"blur\"/><fecomposite operator=\"in\" in=\"tile2\" in2=\"blur\" result=\"cloud\"/><femorphology operator=\"dilate\" radius=\"2\" in=\"SourceAlpha\" result=\"dilate\"/><fecomposite operator=\"in\" in=\"flood2\" in2=\"dilate\" result=\"base\"/><femerge><femergenode in=\"cloud\"/><femergenode in=\"base\"/><femergenode in=\"SourceGraphic\"/></femerge></filter></defs></svg></div><blockquote class=\"markdown_blockquote\">\n<p class=\"xsj_paragraph xsj_paragraph_level_1\"><span class=\"xsj_placeholder_span\"></span>本文为转载文章,如果涉及侵权,请联系 <a href=\"mailto:suziwen1@gmail.com\" class=\"xsj_link xsj_auto_link\">suziwen1@gmail.com</a>,会第一时间删除</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_1\"><span class=\"xsj_placeholder_span\"></span>转载自: <a href=\"https://cjting.me/2018/07/22/js-and-unicode/\" class=\"xsj_link xsj_auto_link\">https://cjting.me/2018/07/22/js-and-unicode/</a></p>\n</blockquote>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\"></p><div class=\"toc mindmap_toc mindmap_container\" data-hash=\"693df743073a0492476a3351d87e6064_mindmap_toc\"><div class=\"xsj_mindmap xsj_mindmap_toc\"><svg id=\"xsj_mindmap_toc_1587196688803\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" class=\"xsj_svg_viewbox\" style=\"max-width:1088px;max-height:956.5px;\" viewbox=\"0 0 1088 956.5\" width=\"100%\" height=\"100%\"><g transform=\"translate(330.5,458.5) scale(1)\"><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#990099\" stroke-width=\"2\" d=\"M376.5,-240.5 L381.5,-240.5 C417.5,-240.5 412.5,-162 448.5,-162 L450.5,-162\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(376.5, -240.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(448.5,-162)\"><path class=\"markmap-node-path\" d=\"M0,0L36,0\" stroke-width=\"2\" stroke=\"#990099\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(36, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(153, 0, 153);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#990099\" stroke-width=\"2\" d=\"M376.5,-240.5 L381.5,-240.5 C417.5,-240.5 412.5,-238 448.5,-238 L450.5,-238\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(376.5, -240.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(448.5,-238)\"><path class=\"markmap-node-path\" d=\"M0,0L124,0\" stroke-width=\"2\" stroke=\"#990099\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(124, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(153, 0, 153);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#990099\" stroke-width=\"2\" d=\"M376.5,-240.5 L381.5,-240.5 C417.5,-240.5 412.5,-314 448.5,-314 L450.5,-314\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(376.5, -240.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(448.5,-314)\"><path class=\"markmap-node-path\" d=\"M0,0L45,0\" stroke-width=\"2\" stroke=\"#990099\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(45, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(153, 0, 153);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#109618\" stroke-width=\"2\" d=\"M468.5,159.5 L473.5,159.5 C509.5,159.5 504.5,410 540.5,410 L542.5,410\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(468.5, 159.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(540.5,410)\"><path class=\"markmap-node-path\" d=\"M0,0L105,0\" stroke-width=\"2\" stroke=\"#109618\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(105, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(16, 150, 24);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#109618\" stroke-width=\"2\" d=\"M468.5,159.5 L473.5,159.5 C509.5,159.5 504.5,334 540.5,334 L542.5,334\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(468.5, 159.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(540.5,334)\"><path class=\"markmap-node-path\" d=\"M0,0L86,0\" stroke-width=\"2\" stroke=\"#109618\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(86, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(16, 150, 24);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#109618\" stroke-width=\"2\" d=\"M468.5,159.5 L473.5,159.5 C509.5,159.5 504.5,218 540.5,218 L542.5,218\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(468.5, 159.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(540.5,218)\"><path class=\"markmap-node-path\" d=\"M0,0L73,0\" stroke-width=\"2\" stroke=\"#109618\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(73, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(16, 150, 24);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#109618\" stroke-width=\"2\" d=\"M468.5,159.5 L473.5,159.5 C509.5,159.5 504.5,142 540.5,142 L542.5,142\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(468.5, 159.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(540.5,142)\"><path class=\"markmap-node-path\" d=\"M0,0L114,0\" stroke-width=\"2\" stroke=\"#109618\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(114, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(16, 150, 24);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#109618\" stroke-width=\"2\" d=\"M468.5,159.5 L473.5,159.5 C509.5,159.5 504.5,66 540.5,66 L542.5,66\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(468.5, 159.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(540.5,66)\"><path class=\"markmap-node-path\" d=\"M0,0L168,0\" stroke-width=\"2\" stroke=\"#109618\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(168, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(16, 150, 24);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#109618\" stroke-width=\"2\" d=\"M468.5,159.5 L473.5,159.5 C509.5,159.5 504.5,-10 540.5,-10 L542.5,-10\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(468.5, 159.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(540.5,-10)\"><path class=\"markmap-node-path\" d=\"M0,0L46,0\" stroke-width=\"2\" stroke=\"#109618\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(46, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(16, 150, 24);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#109618\" stroke-width=\"2\" d=\"M468.5,159.5 L473.5,159.5 C509.5,159.5 504.5,-86 540.5,-86 L542.5,-86\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(468.5, 159.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(540.5,-86)\"><path class=\"markmap-node-path\" d=\"M0,0L123,0\" stroke-width=\"2\" stroke=\"#109618\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(123, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(16, 150, 24);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#dc3912\" stroke-width=\"4\" d=\"M94.5,-40.5 L99.5,-40.5 C171.5,-40.5 166.5,321.5 202.5,321.5 L204.5,321.5\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(94.5, -40.5)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: white;\"/><g transform=\"translate(202.5,321.5)\"><path class=\"markmap-node-path\" d=\"M0,0L172,0\" stroke-width=\"4\" stroke=\"#dc3912\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(172, 0)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: rgb(220, 57, 18);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#ff9900\" stroke-width=\"4\" d=\"M94.5,-40.5 L99.5,-40.5 C171.5,-40.5 166.5,240.5 202.5,240.5 L204.5,240.5\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(94.5, -40.5)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: white;\"/><g transform=\"translate(202.5,240.5)\"><path class=\"markmap-node-path\" d=\"M0,0L219,0\" stroke-width=\"4\" stroke=\"#ff9900\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(219, 0)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: rgb(255, 153, 0);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#109618\" stroke-width=\"4\" d=\"M94.5,-40.5 L99.5,-40.5 C171.5,-40.5 166.5,159.5 202.5,159.5 L204.5,159.5\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(94.5, -40.5)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: white;\"/><g transform=\"translate(202.5,159.5)\"><path class=\"markmap-node-path\" d=\"M0,0L265,0\" stroke-width=\"4\" stroke=\"#109618\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(265, 0)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: rgb(16, 150, 24);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#990099\" stroke-width=\"4\" d=\"M94.5,-40.5 L99.5,-40.5 C171.5,-40.5 166.5,-240.5 202.5,-240.5 L204.5,-240.5\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(94.5, -40.5)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: white;\"/><g transform=\"translate(202.5,-240.5)\"><path class=\"markmap-node-path\" d=\"M0,0L173,0\" stroke-width=\"4\" stroke=\"#990099\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(173, 0)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: rgb(153, 0, 153);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#0099c6\" stroke-width=\"4\" d=\"M94.5,-40.5 L99.5,-40.5 C171.5,-40.5 166.5,-321.5 202.5,-321.5 L204.5,-321.5\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(94.5, -40.5)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: white;\"/><g transform=\"translate(202.5,-321.5)\"><path class=\"markmap-node-path\" d=\"M0,0L78,0\" stroke-width=\"4\" stroke=\"#0099c6\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(78, 0)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: rgb(0, 153, 198);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"4\" d=\"M94.5,-40.5 L99.5,-40.5 C171.5,-40.5 166.5,-402.5 202.5,-402.5 L204.5,-402.5\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(94.5, -40.5)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: white;\"/><g transform=\"translate(202.5,-402.5)\"><path class=\"markmap-node-path\" d=\"M0,0L79,0\" stroke-width=\"4\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(79, 0)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-node markmap-root-node\" transform=\"translate(-238.5,-40.5)\"><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(332, 0)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: rgb(51, 102, 204);\"/><g transform=\"translate(1, -36)\"><rect class=\"markmap-node-rect\" rx=\"10\" ry=\"10\" height=\"72\" width=\"331\" fill=\"rgb(78, 156, 255)\" stroke=\"#3366cc\" stroke-width=\"1\"/><text class=\"markmap-node-text\" alignment-baseline=\"middle\" x=\"166.5\" y=\"46\" text-anchor=\"middle\" style=\"font: bolder 30px sans-serif; fill-opacity: 1; fill: rgb(255, 255, 255);\">JavaScript 与 Unicode</text></g></g><g class=\"markmap-node\" transform=\"translate(202.5,321.5)\"><a xlink:href=\"#reverse20the20string_16\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(220, 57, 18); stroke: white; stroke-width: 2px; cursor: pointer;\">Reverse the String</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(220, 57, 18); cursor: pointer;\">Reverse the String</text></a></g><g class=\"markmap-node\" transform=\"translate(202.5,240.5)\"><a xlink:href=\"#unicode20normalization_15\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(255, 153, 0); stroke: white; stroke-width: 2px; cursor: pointer;\">Unicode Normalization</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(255, 153, 0); cursor: pointer;\">Unicode Normalization</text></a></g><g class=\"markmap-node\" transform=\"translate(202.5,159.5)\"><a xlink:href=\"#js20e4b8ade79a84e5ad97e7aca6e4b8b2e997aee9a298e5928ce8a7a3e586b3e696b9e6b395_7\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(16, 150, 24); stroke: white; stroke-width: 2px; cursor: pointer;\">JS 中的字符串问题和解决方法</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(16, 150, 24); cursor: pointer;\">JS 中的字符串问题和解决方法</text></a></g><g class=\"markmap-node\" transform=\"translate(540.5,410)\"><a xlink:href=\"#regexp20range_14\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(16, 150, 24); stroke: white; stroke-width: 2px; cursor: pointer;\">Regexp Range</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(16, 150, 24); cursor: pointer;\">Regexp Range</text></a></g><g class=\"markmap-node\" transform=\"translate(540.5,334)\"><a xlink:href=\"#regexp20dot_13\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(16, 150, 24); stroke: white; stroke-width: 2px; cursor: pointer;\">Regexp Dot</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(16, 150, 24); cursor: pointer;\">Regexp Dot</text></a></g><g class=\"markmap-node\" transform=\"translate(540.5,218)\"><a xlink:href=\"#substring20substr20slice_12\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(16, 150, 24); stroke: white; stroke-width: 2px; cursor: pointer;\"><tspan x=\"0\" y=\"-5\">Substring,</tspan><tspan x=\"0\" y=\"15\"> Substr,</tspan><tspan x=\"0\" y=\"35\"> Slice</tspan></text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(16, 150, 24); cursor: pointer;\"><tspan x=\"0\" y=\"-5\">Substring,</tspan><tspan x=\"0\" y=\"15\"> Substr,</tspan><tspan x=\"0\" y=\"35\"> Slice</tspan></text></a></g><g class=\"markmap-node\" transform=\"translate(540.5,142)\"><a xlink:href=\"#unicode20escape_11\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(16, 150, 24); stroke: white; stroke-width: 2px; cursor: pointer;\">Unicode Escape</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(16, 150, 24); cursor: pointer;\">Unicode Escape</text></a></g><g class=\"markmap-node\" transform=\"translate(540.5,66)\"><a xlink:href=\"#charat2020charcodeat_10\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(16, 150, 24); stroke: white; stroke-width: 2px; cursor: pointer;\">charAt &amp;&amp; charCodeAt</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(16, 150, 24); cursor: pointer;\">charAt &amp;&amp; charCodeAt</text></a></g><g class=\"markmap-node\" transform=\"translate(540.5,-10)\"><a xlink:href=\"#length_9\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(16, 150, 24); stroke: white; stroke-width: 2px; cursor: pointer;\">length</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(16, 150, 24); cursor: pointer;\">length</text></a></g><g class=\"markmap-node\" transform=\"translate(540.5,-86)\"><a xlink:href=\"#js20e79a84e5ad97e7aca6e4b8b2e5928ce5ad97e7aca6_8\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(16, 150, 24); stroke: white; stroke-width: 2px; cursor: pointer;\">JS 的字符串和字符</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(16, 150, 24); cursor: pointer;\">JS 的字符串和字符</text></a></g><g class=\"markmap-node\" transform=\"translate(202.5,-240.5)\"><a xlink:href=\"#unicode20encoding_3\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(153, 0, 153); stroke: white; stroke-width: 2px; cursor: pointer;\">Unicode Encoding</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(153, 0, 153); cursor: pointer;\">Unicode Encoding</text></a></g><g class=\"markmap-node\" transform=\"translate(448.5,-162)\"><a xlink:href=\"#utf8_6\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(153, 0, 153); stroke: white; stroke-width: 2px; cursor: pointer;\">UTF8</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(153, 0, 153); cursor: pointer;\">UTF8</text></a></g><g class=\"markmap-node\" transform=\"translate(448.5,-238)\"><a xlink:href=\"#utf162020ucs-2_5\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(153, 0, 153); stroke: white; stroke-width: 2px; cursor: pointer;\">UTF16 &amp;&amp; UCS-2</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(153, 0, 153); cursor: pointer;\">UTF16 &amp;&amp; UCS-2</text></a></g><g class=\"markmap-node\" transform=\"translate(448.5,-314)\"><a xlink:href=\"#utf32_4\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(153, 0, 153); stroke: white; stroke-width: 2px; cursor: pointer;\">UTF32</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(153, 0, 153); cursor: pointer;\">UTF32</text></a></g><g class=\"markmap-node\" transform=\"translate(202.5,-321.5)\"><a xlink:href=\"#unicode_2\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(0, 153, 198); stroke: white; stroke-width: 2px; cursor: pointer;\">Unicode</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(0, 153, 198); cursor: pointer;\">Unicode</text></a></g><g class=\"markmap-node\" transform=\"translate(202.5,-402.5)\"><a xlink:href=\"#e59fbae69cace6a682e5bfb5_1\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px; cursor: pointer;\">基本概念</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(51, 102, 204); cursor: pointer;\">基本概念</text></a></g><g class=\"annotation-group\"><g class=\"annotations\"/></g></g></svg></div></div><p></p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">字符串是任何一个编程语言中的重要概念，同时也是一个非常复杂的问题。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">日常编码中可能并不一定能见到它的复杂性，下面是几个字符串操作，使用你最熟悉的编程语言，看看结果如何。</p>\n<ul class=\"markdown_ul\">\n<li><span class=\"xsj_placeholder_span\"></span>逆转字符串 <code>\"noël\"</code>，正确结果应该是 <code>\"lëon\"</code></li>\n<li><span class=\"xsj_placeholder_span\"></span>获取字符串 <code>\"noël\"</code> 前三个字符，正确结果应该是 <code>\"noë\"</code></li>\n<li><span class=\"xsj_placeholder_span\"></span>获取字符串 <code>\"😸😾\"</code> 的长度，正确答案应该是 2</li>\n<li><span class=\"xsj_placeholder_span\"></span>字符串 <code>\"noël\"</code> 和字符串 <code>\"noël\"</code> 规整化以后应该相等（他们看起来一样，但是内部表示不一样，一个 6 字节，一个 5 字节，这里涉及到 Unicode 的规整化）</li>\n</ul>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">对于大部分编程语言，包括 Ruby，Python，JS，C#，Java 等，上面的问题都无法全部返回正确结果（但是，拥有超强 Unicode 支持的 <a href=\"https://elixir-lang.org/\" class=\"xsj_link xsj_manu_link\">Elixir</a> 可以）。</p>\n<!--more-->\n<h2 class=\"xsj_heading_hash xsj_heading xsj_heading_h2\" id=\"e59fbae69cace6a682e5bfb5_1\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"e59fbae69cace6a682e5bfb5_1\" class=\"blank_anchor_name\"></a><a id=\"e59fbae69cace6a682e5bfb5_1\" class=\"blank_anchor_id\"></a><a name=\"基本概念\" class=\"blank_anchor_name\"></a><a id=\"基本概念\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">基本概念</span></h2>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">首先来看关于字符串的几个基本概念。</p>\n<ul class=\"markdown_ul\">\n<li><code>字符集（Character Set）</code>：定义了有哪些字符，任何一段字符串，里面的字符都属于某个字符集，比如经典的 ASCII 字符集以及目前最为常用的 Unicode 字符集。</li>\n<li><code>码点（Code Point）</code>：字符集中的每个字符，都有一个唯一的编号，叫做码点，比如 <code>A</code> 在 ASCII 字符集中的码点是 65。</li>\n<li><code>字符编码（Character Encoding）</code>：将字符转换为字节的方式。对于某些字符集，比如 ASCII，字符编码很简单，直接存储码点即可，比如 <code>A</code>，计算机中存储就是 65 的二进制补码，<code>0b01000001</code>。但是对于 Unicode，字符编码就有很多种，后文我们再详细介绍。</li>\n<li><code>编码单元（Code Unit）</code>：UTF16 中的一个概念，每两个字节称为一个编码单元，一个字符可能使用一个或两个编码单元进行编码</li>\n</ul>\n<h2 class=\"xsj_heading_hash xsj_heading xsj_heading_h2\" id=\"unicode_2\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"unicode_2\" class=\"blank_anchor_name\"></a><a id=\"unicode_2\" class=\"blank_anchor_id\"></a><a name=\"unicode\" class=\"blank_anchor_name\"></a><a id=\"unicode\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Unicode</span></h2>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Unicode 是一项了不起的发明，这个字符集诞生的初衷很简单，我们需要有一个大的字符集囊括地球上的所有语言中的所有文字。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">在 Unicode 诞生之前，每个语言有自己的字符集，比如英语的 ASCII，繁体中文的 Big Five，简体中文的 GB2312 等等。这就使得计算机处理多语言的文档变得十分麻烦，同时，跨语言交流也非常不便，A 语言的文档发给 B 语言的计算机，B 不知道该如何解码，说不定都没有安装 A 语言对应的字符集。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Unicode 项目诞生于 1987 年，1.0 版本于 1991 年发布，目前最新版是 11.0。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Unicode 字符集目前一共分为 17 个平面（Plane），编号为 0 - 16，每个平面由 16 位构成，也就是每个平面可以编码 2^16 = 65536 个字符。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">其中，第一个平面叫做基本平面，<em class=\"markdown_em_asterisk\">BMP, Basic Multilingual Plane</em>，里面编码了最为常用的一些字符。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">剩下 16 个平面都叫做补充平面，<em class=\"markdown_em_asterisk\">Supplementary Plane</em>。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Unicode 的码点从 0 开始，也就是说，目前，Unicode 的字符码点范围为 0x0000 - 0x10FFFF。当然，这中间很多码点没有定义。</p>\n<h2 class=\"xsj_heading_hash xsj_heading xsj_heading_h2\" id=\"unicode20encoding_3\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"unicode20encoding_3\" class=\"blank_anchor_name\"></a><a id=\"unicode20encoding_3\" class=\"blank_anchor_id\"></a><a name=\"unicode-encoding\" class=\"blank_anchor_name\"></a><a id=\"unicode-encoding\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Unicode Encoding</span></h2>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">有了字符集，剩下的问题就是字符编码，即怎样将码点编码成字节。常见的方式有 UTF32，UTF16 以及 UTF8。我们来分别看看每个编码的方式和优缺点。</p>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"utf32_4\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"utf32_4\" class=\"blank_anchor_name\"></a><a id=\"utf32_4\" class=\"blank_anchor_id\"></a><a name=\"utf32\" class=\"blank_anchor_name\"></a><a id=\"utf32\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">UTF32</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">因为目前 Unicode 只用了三个字节就可以完全表示，最为简单的做法是：使用三个字节直接编码码点。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">这种思路对应的编码方式是 <em class=\"markdown_em_asterisk\">UTF32</em>，使用四个字节直接编码码点。这里可能有的同学会问，为什么不使用三个字节？有两个原因：</p>\n<ol class=\"markdown_ol\">\n<li><span class=\"xsj_placeholder_span\"></span>为了以后扩充性考虑，虽然目前三个字节够用，但是以后可能不够用</li>\n<li><span class=\"xsj_placeholder_span\"></span>计算机处理四字节对齐数据会更快，使用三字节，虽然节省了内存，但是处理起来效率很低。这就和我们编程语言中一般有 <code>int8</code>，<code>int16</code>，<code>int32</code>，但是没有 <code>int24</code> 是一个道理。</li>\n</ol>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">UTF32 的优点是编码和解码都非常简单。缺点也非常明显：<strong class=\"markdown_strong_asterisk\">对于英文文本（互联网上绝大部分信息是英文），体积要比 ASCII 大4倍</strong>。这是一个无法接受的缺点，因此 UTF32 基本上是不使用的，HTML5 规范就明确规定网页不得使用 UTF32 进行编码。</p>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"utf162020ucs-2_5\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"utf162020ucs-2_5\" class=\"blank_anchor_name\"></a><a id=\"utf162020ucs-2_5\" class=\"blank_anchor_id\"></a><a name=\"utf16-ucs-2\" class=\"blank_anchor_name\"></a><a id=\"utf16-ucs-2\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">UTF16 &amp;&amp; UCS-2</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">UCS-2 (2-byte Universal Character Set)是一个已经废弃的定长编码，始终使用两个字节编码 BMP中 的字符。对于非 BMP 中的字符，UCS-2 无法编码。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">UTF16 是 UCS-2 的一个扩展，是一个变长编码，结果可能为两个字节，也可能为四个字节。其中每两个字节叫做 <em class=\"markdown_em_asterisk\">Code Unit</em>，编码单元。对于 BMP 中的字符，UTF16 的编码和 UCS-2 一样，使用一个编码单元直接编码字符的码点，对于非 BMP 中的字符，UTF16 使用一个叫做 <code>Surrogate Pair</code> 的技术来进行编码。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">在 BMP 中，并不是所有的码点都定义了字符，存在一个空白区，<code>0xD800 - 0xDFFF</code>这个范围内的码点不定义任何字符。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">除了 BMP，剩下的码点一共是 <code>0x10FFFF - 0xFFFF = 1048576 = 2^20</code> 个，也就是需要 20 位进行编码。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Surrogate Pair 使用两个编码单元来编码一个非 BMP 字符。第一个编码单元的范围为 <code>0xD800 - 0xDBFF</code>，换成二进制为<code>0b1101_10xx_xxxx_xxxx</code>，叫做 <code>Lead Surrogate</code>，正好可以编码 10 位。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">第二个编码单元的范围为 <code>0xDC00 - 0xDFFF</code>，换成二进制为 <code>0b1101_11xx_xxxx_xxxx</code>，叫做 <code>Tail Surrogate</code>，正好也可以用来编码 10 位。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">这样，通过使用两个编码单元，UTF16 就可以将非 BMP 字符的偏移码点值（减去 0x10000 以后的码点值），使用 Surrogate Pair 进行存储，从而编码非 BMP 字符。同时，由于编码单元的范围都在 BMP 未定义字符的区间中，解码也不会产生任何歧义。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">以 emoji <code>😜</code> 为例，码点为 <code>0x1F61C</code>，减去 0x10000，结果为 <code>0xF61C</code>，换成二进制，填充为 20 位，结果是 <code>0000_1111_0110_0001_1100</code>。将这 20 位填充到 Surrogate Pair 中，得到的结果是，Lead Surrogate：<code>1101_1000_0011_1101</code>，Tail Surrogate：<code>1101_1110_0001_1100</code>，换成 16 进制便是 <code>0xD83D 0xDE1C</code>，这就是 <code>😜</code> 的 UTF16 编码。</p>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"utf8_6\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"utf8_6\" class=\"blank_anchor_name\"></a><a id=\"utf8_6\" class=\"blank_anchor_id\"></a><a name=\"utf8\" class=\"blank_anchor_name\"></a><a id=\"utf8\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">UTF8</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">UTF8 是目前使用最多也是最为灵活的一种变长编码，同 UTF16 一样，UTF8 的编码结果是不定长的，在 1 到 4 个字节之间。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">具体规则如下，左边为码点范围，右边为二进制编码形式。</p>\n<ul class=\"markdown_ul\">\n<li><code>0x0000 – 0x007F</code>: <code>0xxx_xxxx</code>，使用一个字节，编码 7 位。</li>\n<li><code>0x0080 – 0x07FF</code>: <code>110x_xxxx</code>, <code>10xx_xxxx</code>，使用两个字节，编码 11 位。</li>\n<li><code>0x0800 – 0xFFFF</code>: <code>1110_xxxx</code>, <code>10xx_xxxx</code>, <code>10xx_xxxx</code>，使用三个字节编码 16 位。</li>\n<li><code>0x10000 – 0x1FFFFF</code>: <code>1111_0xxx</code>, <code>10xx_xxxx</code>, <code>10xx_xxxx</code>, <code>10xx_xxxx</code>，使用四个字节，编码 21 位</li>\n</ul>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">还是以 emoji <code>😜</code> 为例，码点为 <code>0x1F61C</code>，在区间 <code>0x10000 - 0x1FFFFF</code> 之中，需要使用四个字节进行编码。首先将其转换为二进制，填充为 21 位，结果是 <code>0_0001_1111_0110_0001_1100</code>，然后将这 21 位按照上述说明填入，结果是 <code>1111_0000</code>，<code>1001_1111</code>，<code>1001_1000</code>，<code>1001_1100</code>，换成 16 进制便是 <code>0xF0 0x9F 0x98 0x9C</code>，这就是 <code>😜</code> 的 UTF8 编码。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">UTF8 因为它的灵活性，尤其是与 ASCII 的兼容性，目前已经成为事实上的标准。对于编码问题的处理很简单，<strong class=\"markdown_strong_asterisk\">一律选择使用 UTF8 即可</strong>。</p>\n<h2 class=\"xsj_heading_hash xsj_heading xsj_heading_h2\" id=\"js20e4b8ade79a84e5ad97e7aca6e4b8b2e997aee9a298e5928ce8a7a3e586b3e696b9e6b395_7\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"js20e4b8ade79a84e5ad97e7aca6e4b8b2e997aee9a298e5928ce8a7a3e586b3e696b9e6b395_7\" class=\"blank_anchor_name\"></a><a id=\"js20e4b8ade79a84e5ad97e7aca6e4b8b2e997aee9a298e5928ce8a7a3e586b3e696b9e6b395_7\" class=\"blank_anchor_id\"></a><a name=\"js-中的字符串问题和解决方法\" class=\"blank_anchor_name\"></a><a id=\"js-中的字符串问题和解决方法\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">JS 中的字符串问题和解决方法</span></h2>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"js20e79a84e5ad97e7aca6e4b8b2e5928ce5ad97e7aca6_8\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"js20e79a84e5ad97e7aca6e4b8b2e5928ce5ad97e7aca6_8\" class=\"blank_anchor_name\"></a><a id=\"js20e79a84e5ad97e7aca6e4b8b2e5928ce5ad97e7aca6_8\" class=\"blank_anchor_id\"></a><a name=\"js-的字符串和字符\" class=\"blank_anchor_name\"></a><a id=\"js-的字符串和字符\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">JS 的字符串和字符</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">JS 中的字符串，我们可以认为是 <strong class=\"markdown_strong_asterisk\">理解 Surrogate Pair 的 UCS-2</strong>。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">这是因为，JS 中的字符串，我们可以使用 Surrogate Pair 来编码非 BMP 字符，这是 UTF16 的特性，单纯的 UCS-2 是不能理解 Surrogate Pair 的。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">但是 JS 中的字符允许无效的 Surrogate Pair，比如 <code>\"\\uDFFF\\uD800\"</code>，或者单个 Surrogate，比如 <code>\"\\uD800\"</code> 。因此 JS 中的字符也不是 UTF16，单纯的 UTF16 是不允许上面的字符串的。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">另一个问题是，在 JS 看来，什么样的东西是一个字符？因为 JS 是理解 Surrogate Pair 的 UCS-2，因此，<strong class=\"markdown_strong_asterisk\">在 JS 眼中，一个编码单元是一个字符</strong>。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">这就给 JS 中的 Unicode 处理带来了很多问题，基本上所有的字符串操作函数在处理非 BMP 字符时都是错误的。</p>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"length_9\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"length_9\" class=\"blank_anchor_name\"></a><a id=\"length_9\" class=\"blank_anchor_id\"></a><a name=\"length\" class=\"blank_anchor_name\"></a><a id=\"length\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">length</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">最基本的问题就是，非 BMP 的字符，由于使用了 Surrogate Pair，含有两个编码单元，导致 JS 认为字符的长度为 2，这显然不是我们要的结果。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-string\">\"😜\"</span>.length <span class=\"hljs-comment\">// 2</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">解决这个问题，可以自己编写一个 <code>strLength</code> 函数，特别处理码点范围在 <code>0xD800 - 0xDFFF</code> 中的字符，当然这比较麻烦，简单的方案是使用 <a href=\"https://github.com/bestiejs/punycode.js/\" class=\"xsj_link xsj_manu_link\">Punycode</a> 库。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-keyword\">var</span> puny = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"punycode\"</span>)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span>puny.ucs2.decode(<span class=\"hljs-string\">\"😜\"</span>).length <span class=\"hljs-comment\">// 1</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">或者利用 ES6 的新特性：ES6 中的 <code>for of</code> 循环可以正确识别 Unicode，这也就使得和 for of 循环使用相同机制的 <code>...</code> 操作符可以正确识别 Unicode。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-comment\">// 这个做法很浪费内存</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span>[...<span class=\"hljs-string\">\"😜\"</span>].length <span class=\"hljs-comment\">// 1</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"charat2020charcodeat_10\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"charat2020charcodeat_10\" class=\"blank_anchor_name\"></a><a id=\"charat2020charcodeat_10\" class=\"blank_anchor_id\"></a><a name=\"charat-charcodeat\" class=\"blank_anchor_name\"></a><a id=\"charat-charcodeat\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">charAt &amp;&amp; charCodeAt</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\"><code>charAt</code> 以及 <code>charCodeAt</code> 两个方法用于返回某个偏移量的字符和字符码点，对于非 BMP 字符，返回结果是错的，返回的是 Lead Surrogate 的字符和码点。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-string\">\"😜\"</span>.charAt(<span class=\"hljs-number\">0</span>) <span class=\"hljs-comment\">// \"�\"</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span><span class=\"hljs-string\">\"😜\"</span>.charCodeAt(<span class=\"hljs-number\">0</span>) <span class=\"hljs-comment\">// 55357</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">可以使用 ES6 的 <code>String.prototype.codePointAt</code> 和 <code>String.fromCodePoint</code> 两个方法来解决这个问题。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-string\">\"😜\"</span>.codePointAt(<span class=\"hljs-number\">0</span>) <span class=\"hljs-comment\">// 128540</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span><span class=\"hljs-built_in\">String</span>.fromCodePoint(<span class=\"hljs-string\">\"a😜b\"</span>.codePointAt(<span class=\"hljs-number\">1</span>)) <span class=\"hljs-comment\">// \"😜\"</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"unicode20escape_11\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"unicode20escape_11\" class=\"blank_anchor_name\"></a><a id=\"unicode20escape_11\" class=\"blank_anchor_id\"></a><a name=\"unicode-escape\" class=\"blank_anchor_name\"></a><a id=\"unicode-escape\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Unicode Escape</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">JS 中允许使用 <code>\\udddd</code> 以及 <code>\\xdd</code> 的形式指定十六进制的数字插入字符。但是对于非 BMP 的字符，使用这个方式插入，需要首先得到 Surrogate Pair 才行，不能直接根据码点插入，比较麻烦。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-string\">\"\\u1F61C\"</span> <span class=\"hljs-comment\">// \"ὡC\"</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">ES6新提供了 <code>\\u{}</code> 方式，使得根据码点插入字符变得非常简单。注意 escape 中填写的都是码点的十六进制值。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-string\">\"\\u{1F61C}\"</span> <span class=\"hljs-comment\">// \"😜\"</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"substring20substr20slice_12\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"substring20substr20slice_12\" class=\"blank_anchor_name\"></a><a id=\"substring20substr20slice_12\" class=\"blank_anchor_id\"></a><a name=\"substring-substr-slice\" class=\"blank_anchor_name\"></a><a id=\"substring-substr-slice\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Substring, Substr, Slice</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">这三个函数的行为很类似，参数的含义以及是否允许负数索引上有一些细微的不同。他们同样也都不能正确处理非 BMP 字符。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-string\">\"😜\"</span>.substr(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>) <span class=\"hljs-comment\">// \"�\"</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span><span class=\"hljs-string\">\"😜\"</span>.substring(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>) <span class=\"hljs-comment\">// \"�\"</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"3\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">3</span><span class=\"hljs-string\">\"😜\"</span>.slice(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>) <span class=\"hljs-comment\">// \"�\"</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">我们可以利用 ES6 的 <code>for of</code> 实现重新编写这三个函数，下面的实现只用来说明思路，并不完全。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-built_in\">String</span>.prototype.newSubstr = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">start, length</span>) </span>{<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span>  <span class=\"hljs-keyword\">return</span> [...this].slice(start, start + length).join(<span class=\"hljs-string\">\"\"</span>)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"3\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">3</span>}<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"4\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">4</span><span class=\"hljs-built_in\">String</span>.prototype.newSubstring = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">start, end</span>) </span>{<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"5\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">5</span>  <span class=\"hljs-keyword\">return</span> [...this].slice(start, end).join(<span class=\"hljs-string\">\"\"</span>)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"6\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">6</span>}<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"7\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">7</span><span class=\"hljs-built_in\">String</span>.prototype.newSlice = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">start, end</span>) </span>{<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"8\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">8</span>  <span class=\"hljs-keyword\">return</span> [...this].slice(start, end).join(<span class=\"hljs-string\">\"\"</span>)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"9\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">9</span>}<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"10\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">10</span><span class=\"hljs-string\">\"😜\"</span>.newSubstr(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>) <span class=\"hljs-comment\">// \"😜\"</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"11\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">11</span><span class=\"hljs-string\">\"😜\"</span>.newSubstring(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>) <span class=\"hljs-comment\">// \"😜\"</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"12\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">12</span><span class=\"hljs-string\">\"😜\"</span>.newSlice(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>) <span class=\"hljs-comment\">// \"😜\"</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">其他的一些函数都可以用类似的思路解决，不在赘述了。</p>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"regexp20dot_13\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"regexp20dot_13\" class=\"blank_anchor_name\"></a><a id=\"regexp20dot_13\" class=\"blank_anchor_id\"></a><a name=\"regexp-dot\" class=\"blank_anchor_name\"></a><a id=\"regexp-dot\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Regexp Dot</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">JS 中的正则，在处理非 BMP 字符时同样存在问题。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">我们首先来看 <code>.</code> 字符。<code>.</code> 字符在正则中的含义是匹配非换行符以外的任意字符。但是在 JS 中，<code>.</code> 只能匹配一个编码单元，对于使用两个编码单元的非 BMP 字符，则无法匹配。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>/./.test(<span class=\"hljs-string\">\"😜\"</span>) <span class=\"hljs-comment\">// false</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">这个问题的解决方案有两个。第一，自己编写范围来匹配非 BMP 字符。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>/[\\u0000-\\uD7FF][\\uE000-\\uFFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/.test(<span class=\"hljs-string\">\"😜\"</span>) <span class=\"hljs-comment\">// true</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">第二，使用 ES6 引入的 <code>u</code> 标志。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>/./u.test(<span class=\"hljs-string\">\"😜\"</span>) <span class=\"hljs-comment\">// true</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"regexp20range_14\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"regexp20range_14\" class=\"blank_anchor_name\"></a><a id=\"regexp20range_14\" class=\"blank_anchor_id\"></a><a name=\"regexp-range\" class=\"blank_anchor_name\"></a><a id=\"regexp-range\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Regexp Range</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">第二个问题是正则中的范围。范围中如果使用了非 BMP 字符，JS 会报错。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>/[😆-😜]/.test(<span class=\"hljs-string\">\"😜\"</span>)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span>Uncaught <span class=\"hljs-built_in\">SyntaxError</span>: Invalid regular expression: <span class=\"hljs-regexp\">/[😆-😜]/</span>: Range out <span class=\"hljs-keyword\">of</span> order <span class=\"hljs-keyword\">in</span> character <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span></span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"3\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">3</span><span class=\"hljs-built_in\">    <span class=\"hljs-title\">at</span> &lt;<span class=\"hljs-title\">anonymous</span>&gt;:1:1</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">出错的原因在于 <code>/[😆-😜]/</code> 在 JS 中等价于 <code>/[\\uD83D\\uDE06-\\uD83D\\uDE1C]/</code>，而 <code>\\uDE06-\\uD83D</code> 会被解释为一个范围，而这个范围的起始值比结束值要大，因此错误。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">解决方法同样有两个。第一，改写正则。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>/\\uD83D[\\uDE06-\\uDE1C]/.test(<span class=\"hljs-string\">\"😆\"</span>) <span class=\"hljs-comment\">// true</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">第二，还是使用 ES6 引入的 <code>u</code> 标志。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>/[😆-😜]/u.test(<span class=\"hljs-string\">\"😜\"</span>) <span class=\"hljs-comment\">// true</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span>/[\\u{<span class=\"hljs-number\">1</span>F606}-\\u{<span class=\"hljs-number\">1</span>F61C}]/u.test(<span class=\"hljs-string\">\"😜\"</span>) <span class=\"hljs-comment\">// true</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<h2 class=\"xsj_heading_hash xsj_heading xsj_heading_h2\" id=\"unicode20normalization_15\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"unicode20normalization_15\" class=\"blank_anchor_name\"></a><a id=\"unicode20normalization_15\" class=\"blank_anchor_id\"></a><a name=\"unicode-normalization\" class=\"blank_anchor_name\"></a><a id=\"unicode-normalization\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Unicode Normalization</span></h2>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">最后，我们来谈谈 Unicode 的规整化。这个问题和 JS 没关系，是 Unicode 字符集本身的问题。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">根据 Unicode 定义，有些字符属于 <em class=\"markdown_em_asterisk\">修饰字符</em>，也就是和别的字符一起出现的时候会修饰别的字符，两个合在一起构成一个我们人眼中的字符。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">比如，<code>ë</code> 这个字符，由两个 Unicode 码点构成，分别是 <code>U+0065</code> 和 <code>U+0308</code>。这两个都是 Unicode 中的合法字符，拥有自己的码点，但他们合在一起的时候，构成一个我们人类眼中的字符。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">同时，在 Unicode 中，还有一个单独的字符 <code>ë</code>，码点为 <code>U+00EB</code>。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\"><code>ë</code> 和 <code>ë</code> 在我们眼中是一样的字符，但在 Unicode 中却是不同的表现，一个是由两个字符拼接而成，另一个是独立的字符，因此，如果直接比较的话，肯定是不相等的。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-string\">\"ë\"</span> === <span class=\"hljs-string\">\"ë\"</span> <span class=\"hljs-comment\">// false</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">这时候就需要引入规整化，将字符转变为某种特定的形式。Unicode 中定义了四种形式，常用的两种是：</p>\n<ol class=\"markdown_ol\">\n<li><code>NFD</code>: Normalization Form Canonical Decomposition，将所有的单个的复合字符转换为多个字符拼接而成的形式</li>\n<li><code>NFC</code>: Normalization Form Canonical Composition，将所有的拼接而成的符合字符转换为单个字符的形式</li>\n</ol>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">因此，在比较 Unicode 字符串之前，我们需要对两边的字符串规整化到相同的形式，这样结果才是准确的。ES6 中引入的 <code>String.prototype.normalize</code> 方法可以用于字符串的规整化。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-string\">\"ë\"</span>.normalize(<span class=\"hljs-string\">\"NFC\"</span>) === <span class=\"hljs-string\">\"ë\"</span>.normalize(<span class=\"hljs-string\">\"NFC\"</span>) <span class=\"hljs-comment\">// true</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<h2 class=\"xsj_heading_hash xsj_heading xsj_heading_h2\" id=\"reverse20the20string_16\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"reverse20the20string_16\" class=\"blank_anchor_name\"></a><a id=\"reverse20the20string_16\" class=\"blank_anchor_id\"></a><a name=\"reverse-the-string\" class=\"blank_anchor_name\"></a><a id=\"reverse-the-string\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Reverse the String</span></h2>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">由于存在修饰字符，使得字符串取反变成了一个复杂的操作。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">如果不考虑非 BMP 字符，在 JS 中，对字符串取反的一般方式为 <code>str.split(\"\").reverse().join(\"\")</code>。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">考虑到非 BM 字符，我们可以使用 <code>[...str].reverse().join(\"\")</code>。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">但是，如果含有修饰字符的话，使用 <code>...</code> 一样无法返回正确的结果。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>[...<span class=\"hljs-string\">\"mañana\"</span>].reverse().join(<span class=\"hljs-string\">\"\"</span>) <span class=\"hljs-comment\">// \"anãnam\"</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">这里的问题在于对于 <code>\"mañana\"</code> 使用 <code>...</code> 产生的字符数组为 <code>[\"m\", \"a\", \"n\", \"̃\", \"a\", \"n\", \"a\"]</code>，取反以后，修饰字符会跟在 <code>a</code> 的后面，从而产生 <code>ã</code>。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">这个问题需要做手动做一些的处理，在取反之前，将修饰字符和被修饰的字符颠倒一下顺序，然后再取反就行了。我们可以直接使用 <a href=\"https://github.com/mathiasbynens/esrever\" class=\"xsj_link xsj_manu_link\">esrever</a> 库来处理。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">esrever 的 <code>reverse</code> 函数具体实现可以看<a href=\"https://github.com/mathiasbynens/esrever/blob/14b34013dad49106ca08c0e65919f1fc8fea5331/src/esrever.js#L23\" class=\"xsj_link xsj_manu_link\">这里</a>。</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-js hljs javascript code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>esrever.reverse(<span class=\"hljs-string\">\"mañana\"</span>) <span class=\"hljs-comment\">// \"anañam\"</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n</div>\n\n","excerpt":"字符串是任何一个编程语言中的重要概念，同时也是一个非常复杂的问题。\n日常编码中可能并不一定能见到它的复杂性，下面是几个字符串操作，使用你最熟悉的编程语言，看看结果如何。\n对于大部分编程语言，包括 Ruby，Python，JS，C#，Java 等，上面的问题都无法全部返回正确结果（...","docType":"posts","slug":"cjting/js-and-unicode","title":"JavaScript 与 Unicode","customCss":"","createDate":"April 10, 2020","updateDate":"April 18, 2020","tags":["文章","转载","技术","字符编码","javascript"]}},"pageContext":{"slug":"cjting/js-and-unicode","prev":{"title":"关于字符编码","docType":"posts","slug":"cjting/about-string-encoding"},"next":{"title":"HTTP Basic Auth 是怎么样工作的","docType":"posts","slug":"cjting/how-http-basic-auth-work"},"pluginOptions":{"tagsPath":"/tags/","archivesPath":"/archives/","basePath":"/","commentType":"gitalk"},"basePath":"/"}}}