{"componentChunkName":"component---node-modules-suziwen-gatsby-theme-sculpting-src-templates-template-blog-post-js","path":"/http/basic-digest-access-authentication","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://suziwen.github.io/acorns"}},"storyWriterMarkdown":{"id":"a6dfd9e4-dd95-5ca1-bfc6-d24dc81a7dfd","html":"\n\n\t<div class=\"preview html_preview xsj_export_zip\"><div style=\"overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; display: none;\"><svg style=\"display: none;\"><defs id=\"MathJax_SVG_glyphs\"/><defs xmlns=\"http://www.w3.org/2000/svg\"><filter xmlns=\"http://www.w3.org/2000/svg\" id=\"dropshadow\" height=\"130%\">      <fegaussianblur in=\"SourceAlpha\" stddeviation=\"3\"/>       <feoffset dx=\"2\" dy=\"2\" result=\"offsetblur\"/>       <femerge>         <femergenode/>        <femergenode in=\"SourceGraphic\"/>       </femerge>    </filter><filter id=\"editing-stripe-bk\" filterunits=\"userSpaceOnUse\" x=\"-100%\" y=\"-100%\" width=\"300%\" height=\"300%\"><feflood flood-color=\"#700f0f\" result=\"flood1\"/><feflood flood-color=\"#fff\" flood-opacity=\"0.5\" result=\"flood2\"/><feimage xlink:href=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAwcHgiIGhlaWdodD0iMTAwMHB4Ij48ZGVmcz48cGF0dGVybiBpZD0icGF0dGVybiIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeD0iMCIgeT0iMCIgd2lkdGg9IjQiIGhlaWdodD0iNCI+PHBhdGggZD0iTSAtNCAtNCBMIDggOCBNIC04IC00IEwgNCA4IE0gLTQgLTggTCA4IDQiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI3BhdHRlcm4pIi8+PC9zdmc+\" x=\"0\" y=\"0\" width=\"2000\" height=\"1000\" result=\"image\"/><fetile in=\"image\" result=\"tile\"/><fecomposite operator=\"in\" in=\"flood1\" in2=\"tile\" result=\"tile2\"/><fegaussianblur in=\"SourceAlpha\" stddeviation=\"10\" result=\"blur\"/><fecomposite operator=\"in\" in=\"tile2\" in2=\"blur\" result=\"cloud\"/><femorphology operator=\"dilate\" radius=\"2\" in=\"SourceAlpha\" result=\"dilate\"/><fecomposite operator=\"in\" in=\"flood2\" in2=\"dilate\" result=\"base\"/><femerge><femergenode in=\"cloud\"/><femergenode in=\"base\"/><femergenode in=\"SourceGraphic\"/></femerge></filter></defs></svg></div><blockquote class=\"markdown_blockquote\">\n<p class=\"xsj_paragraph xsj_paragraph_level_1\"><span class=\"xsj_placeholder_span\"></span>本文为转载文章,如果涉及侵权,请联系 <a href=\"mailto:suziwen1@gmail.com\" class=\"xsj_link xsj_auto_link\">suziwen1@gmail.com</a>,会第一时间删除</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_1\"><span class=\"xsj_placeholder_span\"></span>转载自: <a href=\"https://www.cnblogs.com/xiongmaomengnan/p/6671206.html\" class=\"xsj_link xsj_auto_link\">https://www.cnblogs.com/xiongmaomengnan/p/6671206.html</a></p>\n</blockquote>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\"></p><div class=\"toc mindmap_toc mindmap_container\" data-hash=\"ba27108122780ec13503182b1c8388d7_mindmap_toc\"><div class=\"xsj_mindmap xsj_mindmap_toc\"><svg id=\"xsj_mindmap_toc_1588076270225\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" class=\"xsj_svg_viewbox\" style=\"max-width:1195px;max-height:311px;\" viewbox=\"0 0 1195 311\" width=\"100%\" height=\"100%\"><g transform=\"translate(569,177.5) scale(1)\"><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#dc3912\" stroke-width=\"4\" d=\"M333,-40.5 L338,-40.5 C410,-40.5 405,40.5 441,40.5 L443,40.5\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(333, -40.5)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: white;\"/><g transform=\"translate(441,40.5)\"><path class=\"markmap-node-path\" d=\"M0,0L110,0\" stroke-width=\"4\" stroke=\"#dc3912\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(110, 0)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: rgb(220, 57, 18);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#ff9900\" stroke-width=\"4\" d=\"M333,-40.5 L338,-40.5 C410,-40.5 405,-40.5 441,-40.5 L443,-40.5\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(333, -40.5)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: white;\"/><g transform=\"translate(441,-40.5)\"><path class=\"markmap-node-path\" d=\"M0,0L136,0\" stroke-width=\"4\" stroke=\"#ff9900\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(136, 0)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: rgb(255, 153, 0);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"4\" d=\"M333,-40.5 L338,-40.5 C410,-40.5 405,-121.5 441,-121.5 L443,-121.5\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(333, -40.5)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: white;\"/><g transform=\"translate(441,-121.5)\"><path class=\"markmap-node-path\" d=\"M0,0L124,0\" stroke-width=\"4\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(124, 0)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-node markmap-root-node\" transform=\"translate(-477,-40.5)\"><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(809, 0)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: rgb(51, 102, 204);\"/><g transform=\"translate(1, -36)\"><rect class=\"markmap-node-rect\" rx=\"10\" ry=\"10\" height=\"72\" width=\"808\" fill=\"rgb(78, 156, 255)\" stroke=\"#3366cc\" stroke-width=\"1\"/><text class=\"markmap-node-text\" alignment-baseline=\"middle\" x=\"405\" y=\"46\" text-anchor=\"middle\" style=\"font: bolder 30px sans-serif; fill-opacity: 1; fill: rgb(255, 255, 255);\">HTTP认证模式：Basic and Digest Access Authentication</text></g></g><g class=\"markmap-node\" transform=\"translate(441,40.5)\"><a xlink:href=\"#e4b88920e5ae89e585a8e9a38ee999a9_3\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(220, 57, 18); stroke: white; stroke-width: 2px; cursor: pointer;\">三. 安全风险</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(220, 57, 18); cursor: pointer;\">三. 安全风险</text></a></g><g class=\"markmap-node\" transform=\"translate(441,-40.5)\"><a xlink:href=\"#e4ba8c20digest20e8aea4e8af81_2\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(255, 153, 0); stroke: white; stroke-width: 2px; cursor: pointer;\">二. Digest 认证</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(255, 153, 0); cursor: pointer;\">二. Digest 认证</text></a></g><g class=\"markmap-node\" transform=\"translate(441,-121.5)\"><a xlink:href=\"#e4b88020basic20e8aea4e8af81_1\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px; cursor: pointer;\">一. Basic 认证</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(51, 102, 204); cursor: pointer;\">一. Basic 认证</text></a></g><g class=\"annotation-group\"><g class=\"annotations\"/></g></g></svg></div></div><p></p>\n<h1 class=\"xsj_heading_hash xsj_heading xsj_heading_h1\" id=\"e4b88020basic20e8aea4e8af81_1\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"e4b88020basic20e8aea4e8af81_1\" class=\"blank_anchor_name\"></a><a id=\"e4b88020basic20e8aea4e8af81_1\" class=\"blank_anchor_id\"></a><a name=\"一-basic-认证\" class=\"blank_anchor_name\"></a><a id=\"一-basic-认证\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">一. Basic 认证</span></h1>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">　　客户端以“ : ”连接用户名和密码后，再经BASE64编码(&nbsp;<a href=\"https://tools.ietf.org/html/rfc2045#section-6.8\" class=\"xsj_link xsj_manu_link\">Base64 Content-Transfer-Encoding</a> )通过Authorization请求头发送该密文至服务端进行验证，每次请求都需要重复发送该密文。<span class=\"mark\">可见Basic认证过程简单，安全性也低，存在泄露个人账号信息以及其他诸多安全问题，最好在实现了Transport Layer Security (TLS)的情况下去使用</span>。以下仅为原理演示，不代表真实情况：</p>\n<ol class=\"markdown_ol\">\n<li><span class=\"xsj_placeholder_span\"></span>客户端向服务器请求数据:</li>\n</ol>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-http hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-keyword\">GET</span> <span class=\"hljs-string\">/</span> HTTP/1.1<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span><span class=\"hljs-attribute\">Host</span>: www.myrealm.com<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<ol start=\"2\" style=\"counter-reset: my-awesome-counter 1;\" class=\"markdown_ol\">\n<li><span class=\"xsj_placeholder_span\"></span>服务端向客户端发送验证请求401：</li>\n</ol>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-http hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>HTTP/1.1 <span class=\"hljs-number\">401</span> Unauthorised<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span><span class=\"hljs-attribute\">Server</span>: bfe/1.0.8.18<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"3\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">3</span><span class=\"hljs-attribute\">WWW-Authenticate</span>: Basic realm=\"myrealm.com\"<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"4\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">4</span><span class=\"hljs-attribute\">Content-Type</span>: text/html; charset=utf-8<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<ol start=\"3\" style=\"counter-reset: my-awesome-counter 2;\" class=\"markdown_ol\">\n<li><span class=\"xsj_placeholder_span\"></span>客户端收到401返回值后，将自动弹出一个登录窗口，等待用户输入用户名和密码</li>\n<li><span class=\"xsj_placeholder_span\"></span>将“用户名:密码”进行BASE64加密后发送服务端进行验证：</li>\n</ol>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-http hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-keyword\">GET</span> <span class=\"hljs-string\">/</span> HTTP/1.1<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span><span class=\"hljs-attribute\">Host</span>: www.myrealm.com<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"3\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">3</span><span class=\"hljs-attribute\">Authorization</span>: Basic xxxxxxxxxxxxxxxxxxxxxxxxxxxx<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<ol start=\"5\" style=\"counter-reset: my-awesome-counter 4;\" class=\"markdown_ol\">\n<li><span class=\"xsj_placeholder_span\"></span>服务端取出Authorization请求头信息进行解密，并与用户数据库进行对比判断是否合法，合法将返回200 OK。<a href=\"http://www.rfcreader.com/#rfc2617\" class=\"xsj_link xsj_manu_link\">RFC 2617</a> 规格中Basic认证不发送Authentication-Info头部，Authentication-Info头部是Digest认证中新增的</li>\n</ol>\n<h1 class=\"xsj_heading_hash xsj_heading xsj_heading_h1\" id=\"e4ba8c20digest20e8aea4e8af81_2\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"e4ba8c20digest20e8aea4e8af81_2\" class=\"blank_anchor_name\"></a><a id=\"e4ba8c20digest20e8aea4e8af81_2\" class=\"blank_anchor_id\"></a><a name=\"二-digest-认证\" class=\"blank_anchor_name\"></a><a id=\"二-digest-认证\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">二. Digest 认证</span></h1>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">　　Digest认证试图解决Basic认证的诸多缺陷而设计，用户密码在整个认证过程中是个关键性要素。</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">　　下为服务端发送的Digest认证响应头部实例及各指令含义说明：(<span class=\"mark\">如果你做PHP开发，其官方文档中发送WWW-Authenticate头部时可能各指令之间用了空格，在Chrome下是不会弹出认证对话框的，应该换成”, “或”,“</span>)</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"nohighlight hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>WWW-Authenticate: Digest realm=\"Restricted area\", qop=\"auth,auth-int\", nonce=\"58e8e52922398\", opaque=\"cdce8a5c95a1427d74df7acbf41c9ce0\", algorithm=\"MD5\"<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<ul class=\"markdown_ul\">\n<li>\n<p class=\"xsj_paragraph xsj_paragraph_level_2\"><strong class=\"markdown_strong_asterisk\">WWW-Authenticate</strong>：服务端发送的认证质询头部</p>\n</li>\n<li>\n<p class=\"xsj_paragraph xsj_paragraph_level_2\"><strong class=\"markdown_strong_asterisk\">Authentication-Info</strong>：服务端发送的认证响应头部，包含nextnonce、rspauth响应摘要等</p>\n</li>\n<li>\n<p class=\"xsj_paragraph xsj_paragraph_level_2\"><strong class=\"markdown_strong_asterisk\">realm</strong>：授权域，至少应该包含主机名</p>\n</li>\n<li>\n<p class=\"xsj_paragraph xsj_paragraph_level_2\"><strong class=\"markdown_strong_asterisk\">domain</strong>：授权访问URIs列表，项与项之间以空格符分隔</p>\n</li>\n<li>\n<p class=\"xsj_paragraph xsj_paragraph_level_2\"><strong class=\"markdown_strong_asterisk\">qop</strong>：质量保护，值为auth或auth-int或[token]，auth-int包含对实体主体做完整性校验</p>\n</li>\n<li>\n<p class=\"xsj_paragraph xsj_paragraph_level_2\"><strong class=\"markdown_strong_asterisk\">nonce</strong>：服务端产生的随机数，用于增加摘要生成的复杂性，从而增加破解密码的难度，防范“中间人”与“恶意服务器”等攻击类型，这是相对于不使用该指令而言的；另外，nonce本身可用于防止重放攻击，用于实现服务端对客户端的认证。<a href=\"http://www.rfcreader.com/#rfc2617\" class=\"xsj_link xsj_manu_link\">RFC 2617</a> 建议采用这个随机数计算公式：nonce = BASE64(time-stamp MD5(time-stamp “:” ETag “:” private-key))，服务端可以决定这种nonce时间有效性，<span class=\"mark\">ETag(URL对应的资源Entity Tag，在CGI编程中通常需要自行生成ETag和鉴别，可用于鉴别URL对应的资源是否改变，区分不同语言、Session、Cookie等)可以防止对已更新资源版本(未更新无效，故需要设定nonce有效期)的重放请求</span>，private-key为服务端私有key</p>\n</li>\n<li>\n<p class=\"xsj_paragraph xsj_paragraph_level_2\"><strong class=\"markdown_strong_asterisk\">opaque</strong>：这是一个不透明的数据字符串，在盘问中发送给客户端，客户端会将这个数据字符串再发送回服务端器。如果需要在服务端和客户端之间维护一些状态，<span class=\"mark\">用nonce来维护状态数据是一种更容易也更安全的实现方式</span></p>\n</li>\n<li>\n<p class=\"xsj_paragraph xsj_paragraph_level_2\"><strong class=\"markdown_strong_asterisk\">stale</strong>：nonce过期标志，值为true或false</p>\n</li>\n<li>\n<p class=\"xsj_paragraph xsj_paragraph_level_2\"><strong class=\"markdown_strong_asterisk\">algorithm</strong>：摘要算法，值为MD5或MD5-sess或[token]，默认为MD5</p>\n</li>\n</ul>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">　　下为客户端发送的Digest认证头请求部实例及各指令含义说明：</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"nohighlight hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>Authorization: Digest username=\"somename\", realm=\"Restricted area\", nonce=\"58e8e52922398\", uri=\"/t.php\", response=\"9c839dde909d270bc5b901c7f80f77d5\", opaque=\"cdce8a5c95a1427d74df7acbf41c9ce0\", qop=\"auth\", nc=00000001, cnonce=\"9c30405c3a67a259\"<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<ul class=\"markdown_ul\">\n<li>\n<p class=\"xsj_paragraph xsj_paragraph_level_2\"><strong class=\"markdown_strong_asterisk\">cnonce</strong>：客户端产生的随机数，用于客户端对服务器的认证。由于“中间人”与“恶意服务器”等攻击方式的存在，导致一个特意选择而非随机唯一的nonce值传给客户端用于摘要的计算成为可能，使得“选择性明文攻击”可能奏效，最后用户密码泄露。因此与nonce一样，cnonce可用于增加摘要生成的复杂性，从而增加破解密码的难度，也就保证了对服务端的认证</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"nohighlight hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>The countermeasure against this attack(选择明文攻击) is for clients to be configured to require the use of the optional \"cnonce\" directive;this allows the client to vary the input to the hash in a way not chosen by the attacker.<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n</li>\n<li>\n<p class=\"xsj_paragraph xsj_paragraph_level_2\"><strong class=\"markdown_strong_asterisk\">nc</strong>：当服务端开启qop时，客户端才需要发送nc(nonce-count)。服务端能够通过维护nc来检测用当前nonce标记的请求重放。如果相同的nc出现在用当前nonce标记的两次请求中，那么这两次请求即为重复请求。<span class=\"mark\">所以对于防止重放攻击而言，除了nonce之外，nc才是最后的保障。因此服务端除了维护用户账号信息之外，还需要维护nonce和nc的关联状态数据</span></p>\n</li>\n</ul>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">　　下面将就摘要计算方法进行说明：&nbsp;</p>\n<ol class=\"markdown_ol\">\n<li>\n<p class=\"xsj_paragraph xsj_paragraph_level_2\"><span class=\"xsj_placeholder_span\"></span>算法的一般性表示</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"nohighlight hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>H(data) = MD5(data)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span>KD(secret, data) = H(concat(secret, \":\", data))<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n</li>\n<li>\n<p class=\"xsj_paragraph xsj_paragraph_level_2\"><span class=\"xsj_placeholder_span\"></span>与安全信息相关的数据用A1表示，则</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"nohighlight hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>a) 采用MD5算法：<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span>    A1=(user):(realm):(password)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"3\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">3</span>b) 采用MD5-sess算法：<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"4\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">4</span>    A1=H((user):(realm):(password)):nonce:cnonce<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n</li>\n<li>\n<p class=\"xsj_paragraph xsj_paragraph_level_2\"><span class=\"xsj_placeholder_span\"></span>与安全信息无关的数据用A2表示，则</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"nohighlight hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>a) QoP为auth或未定义：<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span>    A2=(request-method):(uri-directive-value)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"3\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">3</span>b) QoP为auth-int：<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"4\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">4</span>    A2=(request-method):(uri-directive-value):H((entity-body))<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n</li>\n<li>\n<p class=\"xsj_paragraph xsj_paragraph_level_2\"><span class=\"xsj_placeholder_span\"></span>摘要值用response表示，则</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"nohighlight hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>a) 若qop没有定义：<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span>    response<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"3\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">3</span>    = KD(H(A1),&lt;nonce&gt;:H(A2))<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"4\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">4</span>    = H(H(A1),&lt;nonce&gt;:H(A2))<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"5\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">5</span>b) 若qop为auth或auth-int:<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"6\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">6</span>    response<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"7\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">7</span>    = KD(H(A1),&lt;nonce&gt;:&lt;nc&gt;:&lt;cnonce&gt;:&lt;qop&gt;:H(A2))<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"8\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">8</span>    = H(H(A1),&lt;nonce&gt;:&lt;nc&gt;:&lt;cnonce&gt;:&lt;qop&gt;:H(A2))<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n</li>\n</ol>\n<h1 class=\"xsj_heading_hash xsj_heading xsj_heading_h1\" id=\"e4b88920e5ae89e585a8e9a38ee999a9_3\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"e4b88920e5ae89e585a8e9a38ee999a9_3\" class=\"blank_anchor_name\"></a><a id=\"e4b88920e5ae89e585a8e9a38ee999a9_3\" class=\"blank_anchor_id\"></a><a name=\"三-安全风险\" class=\"blank_anchor_name\"></a><a id=\"三-安全风险\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">三. 安全风险</span></h1>\n<ul class=\"markdown_ul\">\n<li><strong class=\"markdown_strong_asterisk\">在线字典攻击(Online dictionary attacks)</strong>：攻击者可以尝试用包含口令的字典进行模拟计算response，然后与窃听到的任何nonce / response对进行对比，若结果一致则攻击成功。为应对针对弱口令的字典攻击，降低攻击成功的可能性，可以禁止用户使用弱口令</li>\n<li><strong class=\"markdown_strong_asterisk\">中间人(Man in the Middle)</strong>：在一次中间人攻击中，一个弱认证方案被添加并提供给客户端，因此你总是应该从多个备选认证方案中选择使用最强的那一个；甚至中间人可能以Basic认证替换掉服务端提供的Digest认证，从而窃取到用户的安全凭证，然后中间人可利用该凭证去响应服务端的Digest认证盘问；攻击者还可能打着免费缓存代理服务的幌子来招揽轻信者，通过实施中间人攻击，盗取他们的安全凭证；中间代理也可能诱导客户端来发送一个请求给服务端。为此，客户端可考虑给出安全等级风险警示，或在跟踪服务端的认证配置时发现其认证强度降低就发出警告，或配置成只使用强认证，或从指定站点来完成认证</li>\n<li><strong class=\"markdown_strong_asterisk\">预先计算字典攻击(Precomputed dictionary attacks)</strong>：攻击者先构建(response, password) 对字典，然后用选择性明文(nonce)攻击的办法来获得相应盘问的response，检索字典找到匹配的response则攻击成功</li>\n<li><strong class=\"markdown_strong_asterisk\">批量式暴力攻击(Batch brute force attacks)</strong>：中间人会对多个用户执行选择性明文攻击来搜集相应的responses，通过控制搜集的nonce / response对的数量将会缩短找到第一个password的耗时，这种攻击的应对之策就是要求客户端使用cnonce指令</li>\n<li><strong class=\"markdown_strong_asterisk\">假冒服务器欺骗(Spoofing by Counterfeit Servers)</strong>：对于Basic认证，这种攻击方式更容易奏效，对于Digest认证则更难，但前提是客户端必须知道将要使用的是Digest认证。用户在所使用的认证机制中如何发现这一潜在攻击样式应该得到可见的帮助</li>\n</ul>\n</div>\n\n","excerpt":"客户端以“ : ”连接用户名和密码后，再经BASE64编码(&nbsp;Base64 Content-Transfer-Encoding )通过Authorization请求头发送该密文至服务端进行验证，每次请求都需要重复发送该密文。可见Basic认证过程简单，安全性也低，存在泄...","docType":"posts","slug":"http/basic-digest-access-authentication","title":"HTTP认证模式：Basic and Digest Access Authentication","customCss":"","createDate":"April 28, 2020","updateDate":"April 28, 2020","tags":["文章","转载","技术","basic","digest","http"]}},"pageContext":{"slug":"http/basic-digest-access-authentication","prev":{"title":"搭建个人 webdav 服务器","docType":"posts","slug":"tutorial/build-your-own-webdav"},"next":{"title":"2020-4-28 工作日志","docType":"posts","slug":"daily-notes/2020-04-28"},"pluginOptions":{"tagsPath":"/tags/","archivesPath":"/archives/","basePath":"/","commentType":"gitalk"},"basePath":"/"}}}