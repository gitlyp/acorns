<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.21.37"/><link rel="alternate" type="application/rss+xml" title="Your Site&#x27;s RSS Feed" href="/acorns/rss.xml"/><link rel="stylesheet" type="text/css" href="/acorns/libs/zoom/zoom.css?version=sculpting_1_1"/><link rel="stylesheet" type="text/css" href="/acorns/css/story-writer-markdown-default.css?version=sculpting_1_1"/><link rel="stylesheet" type="text/css" href="/acorns/css/story-writer-markdown-components.css?version=sculpting_1_1"/><link rel="stylesheet" type="text/css" href="/acorns/fonts/Webfonts/oswald/stylesheet.css?version=sculpting_1_1"/><link rel="stylesheet" type="text/css" href="/acorns/xsjfonts/fontstyles/zh.css?version=sculpting_1_1"/><link rel="stylesheet" type="text/css" href="/acorns/css/font-awesome.min.css?version=sculpting_1_1"/><link rel="stylesheet" type="text/css" href="/acorns/css/svg-with-js.css?version=sculpting_1_1"/><link rel="stylesheet" type="text/css" href="/acorns/css/gitalk.css?version=sculpting_1_1"/><link rel="icon" type="image/png" href="/acorns/favicon/favicon.png"/><link rel="mask-icon" href="/acorns/favicon/icon.svg" color="brown"/><link rel="icon" type="image/svg+xml" href="/acorns/favicon/favicon.svg"/><link rel="stylesheet" type="text/css" href="/acorns/fonts/Webfonts/aladin/stylesheet.css"/><link as="script" rel="preload" href="/acorns/webpack-runtime-0e44276faebbbc1fe6ef.js"/><link as="script" rel="preload" href="/acorns/framework-4b6e6fca25677e0206fe.js"/><link as="script" rel="preload" href="/acorns/545f34e4-6ab32e105d05a4b785ff.js"/><link as="script" rel="preload" href="/acorns/252f366e-8a7faab70619996ad0cc.js"/><link as="script" rel="preload" href="/acorns/app-73dabbe27fe47f1f504b.js"/><link as="script" rel="preload" href="/acorns/29107295-617a57dac527a4bc3132.js"/><link as="script" rel="preload" href="/acorns/41aca86e-fc6b3df334857d3ab071.js"/><link as="script" rel="preload" href="/acorns/05d954cf-3cfd4b2627b9300c6035.js"/><link as="script" rel="preload" href="/acorns/d24d3e064b601c3fa92397aa9f8c5e3fc3365436-1a38155e33e59d63a824.js"/><link as="script" rel="preload" href="/acorns/component---node-modules-suziwen-gatsby-theme-sculpting-src-templates-template-blog-post-js-efe95cdbe0c15f8f04a1.js"/><link as="fetch" rel="preload" href="/acorns/page-data/tutorial/build-webdav-server-by-nginx/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/acorns/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>(function() { try {
  var mode = localStorage.getItem('theme-ui-color-mode');
  if (!mode) return
  document.body.classList.add('theme-ui-' + mode);
} catch (e) {} })();</script><div id="___gatsby"><style data-emotion-css="116ag8">body{--theme-ui-colors-text:var(--theme-ui-colors-text,#000);--theme-ui-colors-background:var(--theme-ui-colors-background,#fff);--theme-ui-colors-primary:var(--theme-ui-colors-primary,#33e);--theme-ui-colors-secondary:var(--theme-ui-colors-secondary,#119);--theme-ui-colors-muted:var(--theme-ui-colors-muted,#f6f6f6);--theme-ui-colors-accent:var(--theme-ui-colors-accent,#609);--theme-ui-colors-gray:var(--theme-ui-colors-gray,#777);--theme-ui-colors-meta:var(--theme-ui-colors-meta,#1f7199);--theme-ui-colors-built:var(--theme-ui-colors-built,#397300);--theme-ui-colors-literal:var(--theme-ui-colors-literal,#78A960);--theme-ui-colors-highlight:var(--theme-ui-colors-highlight,#ffffcc);color:var(--theme-ui-colors-text,#000);background-color:var(--theme-ui-colors-background,#fff);}body.theme-ui-dark{--theme-ui-colors-text:var(--theme-ui-colors-modes-dark-text,#fff);--theme-ui-colors-background:var(--theme-ui-colors-modes-dark-background,#060606);--theme-ui-colors-primary:var(--theme-ui-colors-modes-dark-primary,#3cf);--theme-ui-colors-secondary:var(--theme-ui-colors-modes-dark-secondary,#e0f);--theme-ui-colors-muted:var(--theme-ui-colors-modes-dark-muted,#191919);--theme-ui-colors-gray:var(--theme-ui-colors-modes-dark-gray,#999);--theme-ui-colors-accent:var(--theme-ui-colors-modes-dark-accent,#c0f);--theme-ui-colors-meta:var(--theme-ui-colors-modes-dark-meta,#1f7199);--theme-ui-colors-built:var(--theme-ui-colors-modes-dark-built,#397300);--theme-ui-colors-literal:var(--theme-ui-colors-modes-dark-literal,#78A960);--theme-ui-colors-highlight:var(--theme-ui-colors-modes-dark-highlight,#29112c);}body.theme-ui-deep{--theme-ui-colors-text:var(--theme-ui-colors-modes-deep-text,hsl(210,50%,96%));--theme-ui-colors-background:var(--theme-ui-colors-modes-deep-background,hsl(230,25%,18%));--theme-ui-colors-primary:var(--theme-ui-colors-modes-deep-primary,hsl(260,100%,80%));--theme-ui-colors-secondary:var(--theme-ui-colors-modes-deep-secondary,hsl(290,100%,80%));--theme-ui-colors-accent:var(--theme-ui-colors-modes-deep-accent,hsl(290,100%,80%));--theme-ui-colors-muted:var(--theme-ui-colors-modes-deep-muted,hsla(230,20%,0%,20%));--theme-ui-colors-gray:var(--theme-ui-colors-modes-deep-gray,hsl(210,50%,60%));--theme-ui-colors-meta:var(--theme-ui-colors-modes-deep-meta,#1f7199);--theme-ui-colors-built:var(--theme-ui-colors-modes-deep-built,#397300);--theme-ui-colors-literal:var(--theme-ui-colors-modes-deep-literal,#78A960);--theme-ui-colors-highlight:var(--theme-ui-colors-modes-deep-highlight,hsl(260,20%,40%));}body.theme-ui-swiss{--theme-ui-colors-text:var(--theme-ui-colors-modes-swiss-text,hsl(10,20%,20%));--theme-ui-colors-background:var(--theme-ui-colors-modes-swiss-background,hsl(10,10%,98%));--theme-ui-colors-primary:var(--theme-ui-colors-modes-swiss-primary,hsl(10,80%,50%));--theme-ui-colors-secondary:var(--theme-ui-colors-modes-swiss-secondary,hsl(10,60%,50%));--theme-ui-colors-accent:var(--theme-ui-colors-modes-swiss-accent,hsl(250,60%,30%));--theme-ui-colors-muted:var(--theme-ui-colors-modes-swiss-muted,hsl(10,20%,94%));--theme-ui-colors-gray:var(--theme-ui-colors-modes-swiss-gray,hsl(10,20%,50%));--theme-ui-colors-meta:var(--theme-ui-colors-modes-swiss-meta,#1f7199);--theme-ui-colors-built:var(--theme-ui-colors-modes-swiss-built,#397300);--theme-ui-colors-literal:var(--theme-ui-colors-modes-swiss-literal,#78A960);--theme-ui-colors-highlight:var(--theme-ui-colors-modes-swiss-highlight,hsl(10,40%,90%));}</style><style data-emotion-css="1s13q8j">*{box-sizing:border-box;}body{margin:0;font-family:'Noto Serif SC',system-ui,'Helvetica Neue',Helvetica,Tahoma,Arial,'Hiragino Sans GB','NSimSun','仿宋体','SimSun','宋体',serif;line-height:1.5;font-weight:400;}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="14i9w9y">.css-14i9w9y{min-height:100VH;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}</style><div class="css-14i9w9y"><style data-emotion-css="7zod2p">html{overflow-y:scroll;}body{margin:0;color:#000;background-color:#fff;}</style><div class="headroom-wrapper"><div style="position:relative;top:0;left:0;right:0;z-index:2;-webkit-transform:translate3D(0, 0, 0);-ms-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)" class="headroom headroom--unfixed"><style data-emotion-css="st9nty">.css-st9nty{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:var(--theme-ui-colors-background,#fff);border-bottom:1px solid;width:100%;}.css-st9nty h1{margin:0;}.css-st9nty ul{margin-left:auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;list-style-type:none;}.css-st9nty li{margin-left:16px;}</style><style data-emotion-css="luk5ak">.css-luk5ak{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:var(--theme-ui-colors-background,#fff);border-bottom:1px solid;width:100%;}.css-luk5ak h1{margin:0;}.css-luk5ak ul{margin-left:auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;list-style-type:none;}.css-luk5ak li{margin-left:16px;}</style><div class="css-luk5ak"><style data-emotion-css="16qc66y">.css-16qc66y{font-family:inherit;font-size:24px;color:inherit;background-color:transparent;width:32px;height:32px;padding:4px;margin:0;margin-left:16px;border:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;}.css-16qc66y:focus{outline:2px solid;}@media screen and (min-width:40em){.css-16qc66y{display:none;}}</style><button title="Toggle Menu" class="css-16qc66y"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></button><style data-emotion-css="umt6is">.css-umt6is{margin-left:16px;font-weight:bold;font-size:1.5em;}.css-umt6is a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}</style><div class="css-umt6is"><a href="https://suziwen.github.io/acorns"><style data-emotion-css="11lk46i">.css-11lk46i{font-size:1.5em;vertical-align:text-bottom;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="css-11lk46i" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M206.135 23.568c-61.993.106-133.212 38.319-173.762 85.328 0 0 94.532-8.388 109.732 35.477 24.55 70.846-103.768 62.832-105.619 173.623-1.394 83.471 89.36 169.758 176.1 169.812 4.214 1.405 181.953 0 181.953 0 19.783-.28 20.606-22.551-48.812-36.637 145.592-147.853-86.742-159.073-85.456-45.779-17.956-18.803.577-99.816 97.692-95.832 32.91 23.48 51.817 27.373 88.56 19.284 6.982-1.537 12.05-25.665-5.462-27.064l-31.78-2.54c-28.106-25.677-34.818-36.477-6.67-57.463 68.87 18.058 77.047 12.076 77.016-13.33-.03-24.855-9.527-90.633-65.832-93.815-7.701-10.311 9.79-42.042-3.953-42.957-19.014-1.266-50.482 28.417-46.266 43.787-18.335 7.755-38.728 31.156-59.15 59.614-69.316 25.43-119.49 142.639-120.15 170.632-.579-182.435 153.242-180.594 140.216-244.77-14.07-69.324-66.992-97.458-118.357-97.37zM432.807 169.97c7.164 0 12.972 5.808 12.972 12.973 0 7.164-5.808 12.972-12.972 12.972-7.165 0-12.973-5.808-12.973-12.972 0-7.165 5.808-12.973 12.973-12.973z"></path></svg><style data-emotion-css="14uqj98">.css-14uqj98{font-family:aladin,sans-serif;font-weight:normal;}</style><span class="css-14uqj98">Scrat&#x27;s Acorn</span></a></div><style data-emotion-css="qwlsg7">.css-qwlsg7{display:none;margin-left:auto;}@media screen and (min-width:650px){.css-qwlsg7{display:block;}}</style><div class="css-qwlsg7"><ul><li><style data-emotion-css="1dbh7qa">.css-1dbh7qa{display:block;padding-left:8px;padding-right:8px;padding-top:8px;padding-bottom:8px;color:inherit;-webkit-text-decoration:none;text-decoration:none;font-size:14px;font-weight:bold;}.css-1dbh7qa.active{color:var(--theme-ui-colors-primary,#33e);}</style><style data-emotion-css="bpnmkh">.css-bpnmkh{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#33e);display:block;padding-left:8px;padding-right:8px;padding-top:8px;padding-bottom:8px;color:inherit;-webkit-text-decoration:none;text-decoration:none;font-size:14px;font-weight:bold;}.css-bpnmkh:hover{color:var(--theme-ui-colors-secondary,#119);}.css-bpnmkh.active{color:var(--theme-ui-colors-primary,#33e);}</style><a class="css-bpnmkh" href="/acorns/">主页</a></li><li><a class="css-bpnmkh" href="/acorns/tags">标签</a></li><li><a class="css-bpnmkh" href="/acorns/archives">归档</a></li><li><a class="css-bpnmkh" href="/acorns/search">搜索</a></li><li><a href="https://github.com/suziwen/markdownxiaoshujiang" target="_blank" rel="noopener noreferrer" class="css-1dbh7qa">Github</a></li></ul></div><style data-emotion-css="oiscss">.css-oiscss{margin-left:auto;margin-right:16px;}@media screen and (min-width:650px){.css-oiscss{margin-left:8px;}}</style><style data-emotion-css="ofhzqr">.css-ofhzqr{-webkit-appearance:none;-moz-appearance:none;appearance:none;font-family:inherit;font-size:14px;font-weight:bold;margin:0;padding-left:8px;padding-right:8px;padding-top:8px;padding-bottom:8px;color:var(--theme-ui-colors-text,#000);background-color:var(--theme-ui-colors-muted,#f6f6f6);border:0;border-radius:2px;margin-left:auto;margin-right:16px;}.css-ofhzqr:focus{outline:2px solid;}@media screen and (min-width:650px){.css-ofhzqr{margin-left:8px;}}</style><button class="css-ofhzqr">default</button></div></div></div><style data-emotion-css="13pmxen">.css-13pmxen{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;}</style><div class="css-13pmxen"><style data-emotion-css="mzzgn5">.css-mzzgn5{width:initial;-webkit-flex:none;-ms-flex:none;flex:none;padding-left:16px;padding-right:16px;padding-top:16px;padding-bottom:32px;margin-top:64px;}@media screen and (min-width:650px){.css-mzzgn5{display:none;width:-webkit-min-content;width:-moz-min-content;width:min-content;margin-top:0;}}</style><div><style data-emotion-css="rrk7cz">.css-rrk7cz{position:fixed;top:0;left:0;bottom:0;z-index:1;min-width:0;width:256px;max-height:100vh;overflow-x:visible;overflow-y:auto;-webkit-overflow-scrolling:touch;-webkit-transition:-webkit-transform .2s ease-out;-webkit-transition:transform .2s ease-out;transition:transform .2s ease-out;-webkit-transform:translate(-100%);-ms-transform:translate(-100%);transform:translate(-100%);background-color:var(--theme-ui-colors-background,#fff);width:initial;-webkit-flex:none;-ms-flex:none;flex:none;padding-left:16px;padding-right:16px;padding-top:16px;padding-bottom:32px;margin-top:64px;}@media screen and (min-width:650px){.css-rrk7cz{position:-webkit-sticky;position:sticky;bottom:auto;max-height:none;-webkit-transform:none;-ms-transform:none;transform:none;background-color:transparent;}}@media screen and (min-width:650px){.css-rrk7cz{display:none;width:-webkit-min-content;width:-moz-min-content;width:min-content;margin-top:0;}}</style><div class="css-rrk7cz"><style data-emotion-css="1rvtlej">.css-1rvtlej{list-style:none;padding:0;margin:0;}</style><ul class="css-1rvtlej"><li><style data-emotion-css="70qvj9">.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-70qvj9"><a class="css-bpnmkh" href="/acorns/">主页</a></div></li><li><div class="css-70qvj9"><a class="css-bpnmkh" href="/acorns/tags">标签</a></div></li><li><div class="css-70qvj9"><a class="css-bpnmkh" href="/acorns/archives">归档</a></div></li><li><div class="css-70qvj9"><a class="css-bpnmkh" href="/acorns/search">搜索</a></div></li><li><div class="css-70qvj9"><a class="css-1dbh7qa" href="https://github.com/suziwen/markdownxiaoshujiang" target="_blank" rel="noopener noreferrer">Github</a></div></li></ul></div></div><style data-emotion-css="2mmr94">.css-2mmr94{position:fixed;max-width:210px;z-index:1;display:none;opacity:0.3;-webkit-transition:opacity .5s;transition:opacity .5s;top:0;bottom:0;left:initial;right:0;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}@media screen and (min-width:650px){.css-2mmr94{display:none;left:0;right:initial;}}@media screen and (min-width:850px){.css-2mmr94{display:none;}}@media screen and (min-width:1200px){.css-2mmr94{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-2mmr94:hover{opacity:1;}.css-2mmr94 .toc-list{background-color:var(--theme-ui-colors-background,#fff);list-style-type:none;margin:0;padding:0;padding-left:16px;padding-top:16px;}.css-2mmr94 .toc-list .toc-list-item{line-height:1.2em;padding-bottom:16px;}.css-2mmr94 .toc-list .toc-list-item:last-child{padding-bottom:0;}.css-2mmr94 .toc-list .toc-link{color:var(--theme-ui-colors-gray,#777);-webkit-text-decoration:none;text-decoration:none;}.css-2mmr94 .toc-list .is-active-link{color:var(--theme-ui-colors-text,#000);font-weight:bold;}</style><div class="toc css-2mmr94"></div><style data-emotion-css="judnid">.css-judnid{-webkit-flex:1;-ms-flex:1;flex:1;z-index:0;overflow:hidden;}</style><div class="css-judnid"><style data-emotion-css="16jkoar">.css-16jkoar{padding:16px;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;min-height:100%;max-width:900px;}@media screen and (min-width:650px){.css-16jkoar{padding:64px;}}</style><div class="css-16jkoar"><section><style data-emotion-css="bzcaho">.css-bzcaho{position:fixed;top:0;left:0;right:0;width:100%;height:3px;background:var(--theme-ui-colors-highlight,#ffffcc);z-index:999;-webkit-transform-origin:0;-ms-transform-origin:0;transform-origin:0;}@media screen and (min-width:1200px){.css-bzcaho{display:none;}}</style><div style="transform:scaleX(0) translateZ(0)" class="css-bzcaho"></div><style data-emotion-css="1yzwfkz">.css-1yzwfkz{cursor:pointer;-webkit-transition:0.35s opacity;transition:0.35s opacity;position:fixed;bottom:1rem;right:1.5rem;height:48px;width:48px;overflow:hidden;z-index:999;display:none;opacity:0;pointer-events:none;}@media screen and (min-width:1200px){.css-1yzwfkz{display:block;}}.css-1yzwfkz:hover #arrow{opacity:1;}</style><div class="css-1yzwfkz"><style data-emotion-css="tfdnh9">.css-tfdnh9 #arrow{-webkit-transition:0.35s all;transition:0.35s all;fill:var(--theme-ui-colors-gray,#777);-webkit-transform:scale(0.22) translate(48px,48px);-ms-transform:scale(0.22) translate(48px,48px);transform:scale(0.22) translate(48px,48px);}.css-tfdnh9 #progress{stroke:var(--theme-ui-colors-text,#000);}.css-tfdnh9 #outline{stroke:var(--theme-ui-colors-gray,#777);}</style><svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 35 35" xml:space="preserve" class="css-tfdnh9"><path id="outline" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path><path id="arrow" d="M3.352,48.296l28.56-28.328l28.58,28.347c0.397,0.394,0.917,0.59,1.436,0.59c0.52,0,1.04-0.196,1.436-0.59   c0.793-0.787,0.793-2.062,0-2.849l-29.98-29.735c-0.2-0.2-0.494-0.375-0.757-0.475c-0.75-0.282-1.597-0.107-2.166,0.456   L0.479,45.447c-0.793,0.787-0.793,2.062,0,2.849C1.273,49.082,2.558,49.082,3.352,48.296z"></path><path fill="none" id="progress" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path></svg></div><style data-emotion-css="1tr4euk">.css-1tr4euk{font-family:oswald,sans-serif;}</style><p class="css-1tr4euk">April 28, 2020</p></section><style data-emotion-css="1ud4cyp">.css-1ud4cyp{box-sizing:border-box;margin:0;min-width:0;font-family:'Noto Sans SC','Helvetica Neue',Helvetica,Tahoma,Arial,'Hiragino Sans GB','Microsoft YaHei','微软雅黑','WenQuanYi Micro Hei',Heiti,'黑体',sans-serif;font-weight:700;line-height:1.25;}</style><h1 class="css-1ud4cyp">使用 nginx 搭建 WebDAV 服务器</h1><section class="post-body"><style data-emotion-css="1jye6mf">.css-1jye6mf{font-family:'Noto Serif SC',system-ui,'Helvetica Neue',Helvetica,Tahoma,Arial,'Hiragino Sans GB','NSimSun','仿宋体','SimSun','宋体',serif;line-height:1.5;font-weight:400;}.css-1jye6mf root{font-family:'Noto Serif SC',system-ui,'Helvetica Neue',Helvetica,Tahoma,Arial,'Hiragino Sans GB','NSimSun','仿宋体','SimSun','宋体',serif;line-height:1.5;font-weight:400;}.css-1jye6mf h1{color:var(--theme-ui-colors-text,#000);font-family:'Noto Sans SC','Helvetica Neue',Helvetica,Tahoma,Arial,'Hiragino Sans GB','Microsoft YaHei','微软雅黑','WenQuanYi Micro Hei',Heiti,'黑体',sans-serif;line-height:1.25;font-weight:700;font-size:32px;}.css-1jye6mf h2{color:var(--theme-ui-colors-text,#000);font-family:'Noto Sans SC','Helvetica Neue',Helvetica,Tahoma,Arial,'Hiragino Sans GB','Microsoft YaHei','微软雅黑','WenQuanYi Micro Hei',Heiti,'黑体',sans-serif;line-height:1.25;font-weight:700;font-size:24px;}.css-1jye6mf h3{color:var(--theme-ui-colors-text,#000);font-family:'Noto Sans SC','Helvetica Neue',Helvetica,Tahoma,Arial,'Hiragino Sans GB','Microsoft YaHei','微软雅黑','WenQuanYi Micro Hei',Heiti,'黑体',sans-serif;line-height:1.25;font-weight:700;font-size:20px;}.css-1jye6mf h4{color:var(--theme-ui-colors-text,#000);font-family:'Noto Sans SC','Helvetica Neue',Helvetica,Tahoma,Arial,'Hiragino Sans GB','Microsoft YaHei','微软雅黑','WenQuanYi Micro Hei',Heiti,'黑体',sans-serif;line-height:1.25;font-weight:700;font-size:16px;}.css-1jye6mf h5{color:var(--theme-ui-colors-text,#000);font-family:'Noto Sans SC','Helvetica Neue',Helvetica,Tahoma,Arial,'Hiragino Sans GB','Microsoft YaHei','微软雅黑','WenQuanYi Micro Hei',Heiti,'黑体',sans-serif;line-height:1.25;font-weight:700;font-size:14px;}.css-1jye6mf h6{color:var(--theme-ui-colors-text,#000);font-family:'Noto Sans SC','Helvetica Neue',Helvetica,Tahoma,Arial,'Hiragino Sans GB','Microsoft YaHei','微软雅黑','WenQuanYi Micro Hei',Heiti,'黑体',sans-serif;line-height:1.25;font-weight:700;font-size:12px;}.css-1jye6mf p{color:var(--theme-ui-colors-text,#000);font-family:'Noto Serif SC',system-ui,'Helvetica Neue',Helvetica,Tahoma,Arial,'Hiragino Sans GB','NSimSun','仿宋体','SimSun','宋体',serif;font-weight:400;line-height:1.5;}.css-1jye6mf a{color:var(--theme-ui-colors-primary,#33e);}.css-1jye6mf a:hover{color:var(--theme-ui-colors-secondary,#119);}.css-1jye6mf pre{font-family:'Roboto Mono',monospace;overflow-x:auto;}.css-1jye6mf pre code{color:inherit;}.css-1jye6mf code{font-family:'Roboto Mono',monospace;color:var(--theme-ui-colors-secondary,#119);font-size:14px;}.css-1jye6mf table{width:100%;margin-top:32px;margin-bottom:32px;border-collapse:separate;border-spacing:0;}.css-1jye6mf table th,.css-1jye6mf table td{text-align:left;padding-top:4px;padding-bottom:4px;padding-right:4px;padding-left:0;border-color:var(--theme-ui-colors-muted,#f6f6f6);border-bottom-style:solid;}.css-1jye6mf th{vertical-align:bottom;border-bottom-width:2px;}.css-1jye6mf td{vertical-align:top;border-bottom-width:1px;}.css-1jye6mf img{max-width:100%;}.css-1jye6mf Container{padding:16px;max-width:1024px;}.css-1jye6mf inlineCode{font-family:'Roboto Mono',monospace;color:var(--theme-ui-colors-secondary,#119);background-color:var(--theme-ui-colors-muted,#f6f6f6);}.css-1jye6mf hr{border:0;border-bottom:1px solid;border-color:var(--theme-ui-colors-muted,#f6f6f6);}.css-1jye6mf blockquote{padding:16px;margin-top:16px;margin-bottom:16px;margin-left:8px;margin-right:16px;border-left-width:5px;border-left-style:solid;border-left-color:var(--theme-ui-colors-text,#000);background-color:var(--theme-ui-colors-muted,#f6f6f6);}.css-1jye6mf .xiaoshujiang_pre{white-space:pre-wrap;font-family:'Roboto Mono',monospace;tab-size:4;}.css-1jye6mf .xiaoshujiang_pre .ol_linenums{margin-top:0;}.css-1jye6mf .hljs{padding:8px;color:var(--theme-ui-colors-text,#000);background-color:var(--theme-ui-colors-muted,#f6f6f6);}.css-1jye6mf .hljs .hljs-subst{color:var(--theme-ui-colors-text,#000);}.css-1jye6mf .hljs .hljs-comment{color:var(--theme-ui-colors-gray,#777);}.css-1jye6mf .hljs .hljs-keyword,.css-1jye6mf .hljs .hljs-attribute,.css-1jye6mf .hljs .hljs-selector-tag,.css-1jye6mf .hljs .hljs-meta-keyword,.css-1jye6mf .hljs .hljs-doctag,.css-1jye6mf .hljs .hljs-name{font-weight:bold;}.css-1jye6mf .hljs .hljs-type,.css-1jye6mf .hljs .hljs-string,.css-1jye6mf .hljs .hljs-number,.css-1jye6mf .hljs .hljs-selector-id,.css-1jye6mf .hljs .hljs-selector-class,.css-1jye6mf .hljs .hljs-quote,.css-1jye6mf .hljs .hljs-template-tag,.css-1jye6mf .hljs .hljs-deletion{color:var(--theme-ui-colors-primary,#33e);}.css-1jye6mf .hljs .hljs-title,.css-1jye6mf .hljs .hljs-section{color:var(--theme-ui-colors-primary,#33e);font-weight:bold;}.css-1jye6mf .hljs .hljs-regexp,.css-1jye6mf .hljs .hljs-symbol,.css-1jye6mf .hljs .hljs-variable,.css-1jye6mf .hljs .hljs-template-variable,.css-1jye6mf .hljs .hljs-link,.css-1jye6mf .hljs .hljs-selector-attr,.css-1jye6mf .hljs .hljs-selector-pseudo{color:var(--theme-ui-colors-secondary,#119);}.css-1jye6mf .hljs .hljs-literal{color:var(--theme-ui-colors-literal,#78A960);}.css-1jye6mf .hljs .hljs-built_in,.css-1jye6mf .hljs .hljs-bullet,.css-1jye6mf .hljs .hljs-code,.css-1jye6mf .hljs .hljs-addition{color:var(--theme-ui-colors-built,#397300);}.css-1jye6mf .hljs .hljs-meta{color:var(--theme-ui-colors-meta,#1f7199);}.css-1jye6mf .hljs .hljs-meta-string{color:var(--theme-ui-colors-accent,#609);}.css-1jye6mf .hljs .hljs-emphasis{font-style:italic;}.css-1jye6mf .hljs .hljs-strong{font-weight:bold;}</style><div class="css-1jye6mf"><div><style></style>


	<div class="preview html_preview xsj_export_zip"><div style="overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; display: none;"><svg style="display: none;"><defs id="MathJax_SVG_glyphs"/><defs xmlns="http://www.w3.org/2000/svg"><filter xmlns="http://www.w3.org/2000/svg" id="dropshadow" height="130%">      <fegaussianblur in="SourceAlpha" stddeviation="3"/>       <feoffset dx="2" dy="2" result="offsetblur"/>       <femerge>         <femergenode/>        <femergenode in="SourceGraphic"/>       </femerge>    </filter><filter id="editing-stripe-bk" filterunits="userSpaceOnUse" x="-100%" y="-100%" width="300%" height="300%"><feflood flood-color="#700f0f" result="flood1"/><feflood flood-color="#fff" flood-opacity="0.5" result="flood2"/><feimage xlink:href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAwcHgiIGhlaWdodD0iMTAwMHB4Ij48ZGVmcz48cGF0dGVybiBpZD0icGF0dGVybiIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeD0iMCIgeT0iMCIgd2lkdGg9IjQiIGhlaWdodD0iNCI+PHBhdGggZD0iTSAtNCAtNCBMIDggOCBNIC04IC00IEwgNCA4IE0gLTQgLTggTCA4IDQiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI3BhdHRlcm4pIi8+PC9zdmc+" x="0" y="0" width="2000" height="1000" result="image"/><fetile in="image" result="tile"/><fecomposite operator="in" in="flood1" in2="tile" result="tile2"/><fegaussianblur in="SourceAlpha" stddeviation="10" result="blur"/><fecomposite operator="in" in="tile2" in2="blur" result="cloud"/><femorphology operator="dilate" radius="2" in="SourceAlpha" result="dilate"/><fecomposite operator="in" in="flood2" in2="dilate" result="base"/><femerge><femergenode in="cloud"/><femergenode in="base"/><femergenode in="SourceGraphic"/></femerge></filter></defs></svg></div><blockquote class="markdown_blockquote">
<p class="xsj_paragraph xsj_paragraph_level_1"><span class="xsj_placeholder_span"></span>本文为转载文章,如果涉及侵权,请联系 <a href="mailto:suziwen1@gmail.com" class="xsj_link xsj_auto_link">suziwen1@gmail.com</a>,会第一时间删除</p>
<p class="xsj_paragraph xsj_paragraph_level_1"><span class="xsj_placeholder_span"></span>转载自: <a href="https://www.binss.me/blog/build-webdav-server-by-nginx/" class="xsj_link xsj_auto_link">https://www.binss.me/blog/build-webdav-server-by-nginx/</a></p>
</blockquote>
<p class="xsj_paragraph xsj_paragraph_level_0"></p><div class="toc mindmap_toc mindmap_container" data-hash="28a55a0f0ee61cdb34c052bde7dd51dd_mindmap_toc"><div class="xsj_mindmap xsj_mindmap_toc"><svg id="xsj_mindmap_toc_1588046983767" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="xsj_svg_viewbox" style="max-width:889px;max-height:311px;" viewbox="0 0 889 311" width="100%" height="100%"><g transform="translate(402.5,177.5) scale(1)"><g class="markmap-link" style="fill:none;"><path stroke="#dc3912" stroke-width="4" d="M166.5,-40.5 L171.5,-40.5 C243.5,-40.5 238.5,40.5 274.5,40.5 L276.5,40.5"/><polygon class="markmap-link-polygon" stroke-width="0" transform="translate(166.5, -40.5)" points="0,-3 5,0 0,3 -5,0" style="fill: white;"/><g transform="translate(274.5,40.5)"><path class="markmap-node-path" d="M0,0L121,0" stroke-width="4" stroke="#dc3912"/><polygon class="markmap-node-polygon" stroke-width="0" transform="translate(121, 0)" points="0,-2 5,0 0,2 -5,0" style="fill: rgb(220, 57, 18);"/></g></g><g class="markmap-link" style="fill:none;"><path stroke="#ff9900" stroke-width="4" d="M166.5,-40.5 L171.5,-40.5 C243.5,-40.5 238.5,-40.5 274.5,-40.5 L276.5,-40.5"/><polygon class="markmap-link-polygon" stroke-width="0" transform="translate(166.5, -40.5)" points="0,-3 5,0 0,3 -5,0" style="fill: white;"/><g transform="translate(274.5,-40.5)"><path class="markmap-node-path" d="M0,0L163,0" stroke-width="4" stroke="#ff9900"/><polygon class="markmap-node-polygon" stroke-width="0" transform="translate(163, 0)" points="0,-2 5,0 0,2 -5,0" style="fill: rgb(255, 153, 0);"/></g></g><g class="markmap-link" style="fill:none;"><path stroke="#3366cc" stroke-width="4" d="M166.5,-40.5 L171.5,-40.5 C243.5,-40.5 238.5,-121.5 274.5,-121.5 L276.5,-121.5"/><polygon class="markmap-link-polygon" stroke-width="0" transform="translate(166.5, -40.5)" points="0,-3 5,0 0,3 -5,0" style="fill: white;"/><g transform="translate(274.5,-121.5)"><path class="markmap-node-path" d="M0,0L150,0" stroke-width="4" stroke="#3366cc"/><polygon class="markmap-node-polygon" stroke-width="0" transform="translate(150, 0)" points="0,-2 5,0 0,2 -5,0" style="fill: rgb(51, 102, 204);"/></g></g><g class="markmap-node markmap-root-node" transform="translate(-310.5,-40.5)"><polygon class="markmap-node-polygon" stroke-width="0" transform="translate(476, 0)" points="0,-3 5,0 0,3 -5,0" style="fill: rgb(51, 102, 204);"/><g transform="translate(1, -36)"><rect class="markmap-node-rect" rx="10" ry="10" height="72" width="475" fill="rgb(78, 156, 255)" stroke="#3366cc" stroke-width="1"/><text class="markmap-node-text" alignment-baseline="middle" x="238.5" y="46" text-anchor="middle" style="font: bolder 30px sans-serif; fill-opacity: 1; fill: rgb(255, 255, 255);">使用 nginx 搭建 WebDAV 服务器</text></g></g><g class="markmap-node" transform="translate(274.5,40.5)"><a xlink:href="#plan20b20nginx_3"><text class="markmap-node-text" y="-5" text-anchor="start" x="0" style="fill-opacity: 1; font: 20px sans-serif; fill: rgb(220, 57, 18); stroke: white; stroke-width: 2px; cursor: pointer;">Plan B: nginx</text><text class="markmap-node-text" y="-5" text-anchor="start" x="0" style="fill-opacity: 1; font: 20px sans-serif; fill: rgb(220, 57, 18); cursor: pointer;">Plan B: nginx</text></a></g><g class="markmap-node" transform="translate(274.5,-40.5)"><a xlink:href="#plan20a20nextcloud_2"><text class="markmap-node-text" y="-5" text-anchor="start" x="0" style="fill-opacity: 1; font: 20px sans-serif; fill: rgb(255, 153, 0); stroke: white; stroke-width: 2px; cursor: pointer;">Plan A: nextcloud</text><text class="markmap-node-text" y="-5" text-anchor="start" x="0" style="fill-opacity: 1; font: 20px sans-serif; fill: rgb(255, 153, 0); cursor: pointer;">Plan A: nextcloud</text></a></g><g class="markmap-node" transform="translate(274.5,-121.5)"><a xlink:href="#webdav20e698afe4bb80e4b988_1"><text class="markmap-node-text" y="-5" text-anchor="start" x="0" style="fill-opacity: 1; font: 20px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px; cursor: pointer;">WebDAV 是什么</text><text class="markmap-node-text" y="-5" text-anchor="start" x="0" style="fill-opacity: 1; font: 20px sans-serif; fill: rgb(51, 102, 204); cursor: pointer;">WebDAV 是什么</text></a></g><g class="annotation-group"><g class="annotations"/></g></g></svg></div></div><p></p>
<h2 class="xsj_heading_hash xsj_heading xsj_heading_h2" id="webdav20e698afe4bb80e4b988_1"><div class="xiaoshujiang_element xsj_anchor">
  <a name="webdav20e698afe4bb80e4b988_1" class="blank_anchor_name"></a><a id="webdav20e698afe4bb80e4b988_1" class="blank_anchor_id"></a><a name="webdav-是什么" class="blank_anchor_name"></a><a id="webdav-是什么" class="blank_anchor_id"></a>
</div>
<span class="xsj_heading_content">WebDAV 是什么</span></h2>
<p class="xsj_paragraph xsj_paragraph_level_0">根据 wikipedia ：</p>
<blockquote class="markdown_blockquote">
<p class="xsj_paragraph xsj_paragraph_level_1"><span class="xsj_placeholder_span"></span>Web Distributed Authoring and Versioning (WebDAV) is an extension of the Hypertext Transfer Protocol (HTTP) that allows clients to perform remote Web content authoring operations.</p>
<p class="xsj_paragraph xsj_paragraph_level_1"><span class="xsj_placeholder_span"></span>The WebDAV protocol provides a framework for users to create, change and move documents on a server. The most important features of the WebDAV protocol include the maintenance of properties about an author or modification date, namespace management, collections, and overwrite protection. Maintenance of properties includes such things as the creation, removal, and querying of file information.</p>
</blockquote>
<p class="xsj_paragraph xsj_paragraph_level_0">个人理解，WebDAV 就是通过 Restful API ，实现对服务端文件的 创建 / 删除 / 读取 / 修改，比起其他文件传输协议，它基于 HTTP，不容易被当作不明流量被砍掉。同时能够利用 HTTP 的各种扩展，比如 HTTPS 提供数据加密功能、HTTP 2.0 提供数据流传输、HTTP 范围请求(RFC7233)等。</p>
<p class="xsj_paragraph xsj_paragraph_level_0">正是因为这些好处，很多系统和软件都提供了对 WebDAV 的支持。比如说 OS X 的 finder 支持远程连接到 WebDAV 服务器。IOS 的播放器 nPlayer 能够播放 WebDAV 上的视频文件，且传输速度高于 FTP / SMB 等协议。</p>
<p class="xsj_paragraph xsj_paragraph_level_0">于是乎，我选择了 WebDAV 作为远程播放 NAS 视频流的传输协议。</p>
<h2 class="xsj_heading_hash xsj_heading xsj_heading_h2" id="plan20a20nextcloud_2"><div class="xiaoshujiang_element xsj_anchor">
  <a name="plan20a20nextcloud_2" class="blank_anchor_name"></a><a id="plan20a20nextcloud_2" class="blank_anchor_id"></a><a name="plan-a-nextcloud" class="blank_anchor_name"></a><a id="plan-a-nextcloud" class="blank_anchor_id"></a>
</div>
<span class="xsj_heading_content">Plan A: nextcloud</span></h2>
<p class="xsj_paragraph xsj_paragraph_level_0">我将下载下来的电影目录挂载到个人网盘 nextcloud 上，并在 nextcloud 中配置为外部挂载。</p>
<p class="xsj_paragraph xsj_paragraph_level_0">我搭建 nextcloud 的架构如下：</p>
<div class="xiaoshujiang_code_container"><div class="xiaoshujiang_pre"><div class="nohighlight hljs code_linenums xiaoshujiang_code"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;"><li class="li_linenum " date-linenum="1"><span class="li_linenum_before_span li_linenum_before_span_hide">1</span>nginx - nextcloud - redis<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="2"><span class="li_linenum_before_span li_linenum_before_span_hide">2</span>                  - mariadb<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li></ol></div></div></div>
<p class="xsj_paragraph xsj_paragraph_level_0">组件之间各自容器化部署，然后通过 tcp 进行连接。</p>
<p class="xsj_paragraph xsj_paragraph_level_0">由于 nextcloud 自带 WebDAV 服务，我们可以直接连接上去：</p>
<p class="xsj_paragraph xsj_paragraph_level_0"></p><div class="story_image_container story_block_image"><div class="story_image"><div class="gatsby-wrapper-image" style="display:inline-block;max-width: 100%;width:224px; margin-left: auto; margin-right: auto;position:relative;"><div style="width:100%;display:block;padding-bottom: 267.85714285714283%;"></div><img class="background_image" src="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='1071'%20viewBox='0%200%20400%201071'%20preserveAspectRatio='none'%3e%3cpath%20d='M0%2032c0%2030%200%2031%202%2031s2-1%202-31C4%201%204%200%202%200S0%201%200%2032m24-15v11l1%209h24v-8c0-9%200-9-7-9l-7-2c-2-2-10-3-11-1m62%209v8l-2-5-2-5-1-2c-1-5-3-3-6%204l-3%208c0%202%203%201%204-2%200-3%205-3%206%201%201%202%202%202%204%202s3-1%203-8c0-11-3-12-3-1m33-3c-6%205-1%2016%206%2012h4c2%202%207%200%208-2%200-2-3-6-5-6l-1-1h3c2%200%202%200%202-2s-6-3-7%200l-1%201-3-1c-2-2-4-2-6-1M33%2086c-4%200-9%206-10%2011-1%2012%2014%2020%2023%2011%209-11%200-24-13-22m5%207l2%206c4%205%202%206-4%203-2-2-3-2-3-4l2-5c0-5-4-3-7%201-4%209%207%2018%2015%2011%204-3%203-12-2-15l-3-1v4m37-1v14l1-2c0-4%202-4%205%200s4%203%202-1v-5c2-2%202-3%201-5-2-2-8-3-9-1m-41%2072c-2%203-2%203-6%203-5%200-5%202-1%204%203%202%204%203%202%207-1%204%200%204%204%202h6c5%203%205%203%204-2%200-4%200-5%202-6%204-3%204-5-1-5-3%200-4-1-5-4-2-4-4-4-5%201m67%205l-1%203c0%203-3%202-3-1l-2-3c-1%200-1%204%202%208%201%204%203%203%204-1%202-5%203-6%203-3%200%204%203%207%206%207%204%200%205-2%205-6%200-6-5-8-9-4h-2c0-3-2-2-3%200m-60%2064l-2%202-9%203c-3%200-5%202-5%204%200%204%202%205%206%205%203%200%205%201%207%204%204%203%208%204%2010%201%201-4-1-6-4-6l-7-2-3-1%202-2%206-1c3-1%206-2%206-5%200-4-5-5-7-2m95%204c0%202%200%202-2%202-4-2-7%207-4%2011h8c1-1%201-15-1-15l-1%202m68%202c-5%203-3%2011%202%2012l5-1c2-2%201-8-1-10s-3-2-6-1M40%20306c-3%203-7%205-10%204-3%200-5%202-5%205%200%202%202%204%205%204%202-1%209%203%2010%205%202%203%207%203%208%200%201-4-1-6-4-6l-10-3%208-4c4%201%205%200%206-3%201-5-4-7-8-2m96%203c0%202-1%202-3%202-3%200-3%200-4%206-1%205%204%208%209%205%201-1%201-14-1-15l-1%202m57%203c-3%201-1%2010%203%2011%203%201%206-2%206-6%200-6-3-7-9-5M37%20378c-4%204-6%207-5%209%200%203%203%202%203%200%200-3%207-9%208-7v2c-1%201%200%204%201%204%204%200%204-9%200-10-2-1-4-1-7%202m100%201l-1%202c0%202-1%202-2%202-3-1-5%201-5%206%200%204%200%205%203%206%205%201%206%200%207-8%200-7-1-10-2-8m10%208l1%208h3c4%200%206-2%206-6s1-4%203%201c1%205%201%206-1%208-1%202-1%202%201%202s6-8%208-14c1-4-2-4-3%201-2%204-3%204-4-1-1-3-1-3-3-2-1%202-2%202-3%200s-2-2-4-1c-2%200-2%200-2-2l-1-2-1%208m-109-1c-1%204-7%209-8%207v-3c2-3-2-4-4-1-3%204%201%2010%206%209%203-2%2010-9%209-12%200-3-3-3-3%200m-13%2064v5l15%2015%204-4%204-4-3-4c-10-10-11-11-16-11-4%200-4%200-4%203m71%206v4l-1%206c-1%204%200%206%204%206s7-2%207-5c0-1-2-2-5-2s-3-1%200-3c2%200%203-1%203-4%200-4%200-4-3-4l-5%202m-58%2063v3c2%201%202%201-1%203l-2%204c1%203%204%203%206%201l3-2%203%201c2%200%202-10-1-10h-8m-11%203c-2%201-2%203-2%209%200%2010%201%2011%2011%2011%208%200%2010-1%2010-7-1-4-3-5-3-1v4H29v-14h4l3-1c-1-2-7-2-9-1m151%205c-7%201-6%2012%201%2012%204%200%207-8%203-11l-2-2-2%201m29%201l-1%205-1%206c-2%204%201%205%209%204l1-2c1-3-1-5-3-5h-3l2-2%203-2c1-4%200-5-3-5l-4%201M1%20745l-1%2036c0%2035%200%2036%202%2036s2-1%202-36a453%20453%200%2000-3-36m32%2025l-2%201c-2-1-5%201-5%204%201%201%200%202-1%203-3%201-3%204%200%205%201%201%202%202%201%204%200%202%204%206%205%204h2l2%202c2%201%205%200%205-2h3c1%202%204-2%203-5l1-2c3%200%203-6%200-6v-3c0-3-2-5-5-5h-2c-1-2-6-2-7%200m39%203c-3%202-2%207%202%209%205%202%203%206-2%204-2%200-2%200-2%202%200%203%207%203%209%200l2-2%202%202c1%202%202%202%204%202%204-1%206-4%201-4l-3-1%201-1c2%202%206-1%206-3%201-1%201%200%201%202%200%205%201%207%204%207%202%200%202-1%201-3-3-3-3-7%200-8%202%200%202%200%202%203%200%205%202%208%204%208s3-1%201-3c-3-2-2-6%200-8%201-1%201-1-1-3s-3-2-4%200c-1%201-4%202-4%200s-3-1-3%201c-1%202-1%202-3%200-3-1-8%200-9%203%200%202%200%202-5%200-4-2-4-3-2-4h2c2%201%204-1%203-3h-7m55%204l-2%202a518%20518%200%2000-1%2011c-1%202%201%205%205%205s6-2%206-5c0-1%200-2%201-1h7c2-2%201-6-1-7-3-1-4-3-1-3%202%201%204-1%203-2s-7%200-8%201h-1c-1-1-5-2-8-1M22%20850v19h18c2-1%202-2%202-8l-1-9v-3h-9l-10%201m27%200c-3%202-3%207%202%209%204%202%204%205-1%204-3%200-3%200-3%202%201%204%2011%201%2011-3%200-2-2-5-4-5l-3-2c-2-1%200-3%203-2%203%200%203-2%201-3h-6m55%207c0%207%201%209%202%209s2-2%202-5c0-8%204-7%204%201%201%206%203%205%203-1s-2-8-6-8l-1-2c0-1%200-2-2-2s-2%201-2%208m26-7v2l-3%201c-4%200-5%202-5%208%200%205%202%207%207%205h4v-9c0-8-1-10-3-7m12%201c0%202-1%203-2%203-5%200-6%201-6%205%200%206%203%209%207%208l4-1v-9l-1-8-2%202m-117%201l-1%208v7h16v-6c0-9-1-10-8-10l-7%201m49%202c-3%200-4%205-2%209%203%206%208%205%2011-3%201-1%201-1%201%201%200%206%203%207%205%202l1-3%202%203%202%203c1%201%205-11%204-11-1-2-3-1-3%202l-1%204-1-4c-2-4-4-4-5%201l-1%203-1-4c-1-3-2-4-4-1h-1c0-1-3-3-5-3l-2%201m75%200c-3%202-3%2011%200%2012%203%202%207%201%207-1%200-1-1-2-3-2-4%201-4-2%200-2%203%200%204-1%204-3%200-4-4-6-8-4m45%201c-4%204-1%2012%204%2012%204-1%206-4%201-4l-3-1%202-1c4%201%206-1%204-5-2-3-5-4-8-1M49%20904v15c1%202%206%202%208%200%205-4%200-15-5-12-1%201-1%200-1-1%200-3-1-4-2-2m-32%201v3l3%2010c0%204%203%201%205-3l1-5%202%205c1%206%204%207%205%202l1-3%201-6c1-4%201-4-1-4l-2%204c-1%206-2%206-3%201l-3-5-2%205c-1%204-2%203-3-1-2-3-3-5-4-3m44%207c0%209%200%209%206%208%205-1%207-3%207-8%200-6-2-8-8-8h-5v8m18-6l-3%208c-2%206-2%206%200%206l2-2c1-4%205-4%207-1%201%203%203%204%203%201l-1-4-3-7c-2-4-4-4-5-1m-41%203c-5%205-1%2013%205%2011%204%200%204-2%200-2s-4-3%200-3c4-1%205-3%202-6-2-3-5-3-7%200m20%2048c-2%200-2%201-2%209s1%2011%202%205c1-2%202-2%203-2%205%202%208-8%203-12h-6m269%200c-2%200-3%2010-1%2012l1-3c0-4%202-8%204-7l1%205c0%206%203%205%203%200%201-6%203-6%204-1%201%206%203%206%203%201%200-6-2-7-8-7h-7m-208%2047c0%202%200%202-2%202-3-1-6%202-6%206%200%205%202%207%206%206s5-3%204-11c0-5-2-7-2-3m13%200c-1%202-1%202-3%202-3-1-5%202-5%207l1%205h9v-8c0-8-1-11-2-6m58%204c-3%203-1%2011%203%2011%205%200%208-8%205-12-2-2-6-1-8%201m96-1c-4%206%202%2015%207%2010%202-2%203-8%201-10h-8m-192%2028l-1%208v8h4c6%200%209-5%207-13%200-3-8-5-10-3m-45%201l1%208a212%20212%200%20013%207l2-5c2-6%203-5%205%201%201%204%203%205%203%202l1-4c2-4%203-8%202-9s-3%203-3%206-2%202-4-3c-1-5-3-5-4%200-2%206-3%206-3%201-1-4-2-6-3-4m31%207l1%208h3c4%200%206-1%206-6s-2-7-5-7l-3-1c-1-4-2-1-2%206'%20fill='%23d3d3d3'%20fill-rule='evenodd'/%3e%3c/svg%3e" style="position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;"><img src="/acorns/static/370d092a172378671db39e796b445331/2bad8/1588047143716.jpg" alt title name="images/1588047143716.jpg" data-src="./images/1588047143716.jpg" class="front_image" loading="lazy" srcSet="/acorns/static/370d092a172378671db39e796b445331/2bad8/1588047143716.jpg 224w" sizes="(max-width: 224px) 100vw, 224px" data-action="zoom" style="max-width: 100%;position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;"></div><br><div class="story_image_caption story_image_blank_caption"></div></div></div><p></p>
<p class="xsj_paragraph xsj_paragraph_level_0">但实际实验下来体验很差。在播放大于 2 G 的视频时，加载缓慢，拖动进度条后有大概率卡死，NUC 的 CPU 占用率大幅飙升，不久后 nextcloud 的 3 个 php-handler 进程陷入 D(TASK_UNINTERRUPTIBLE) 状态，简单来说就是卡死了，需要重启进程(容器)。</p>
<p class="xsj_paragraph xsj_paragraph_level_0">虽然我的机器是功耗 15W 的 NUC ，但它也没有菜到这种地步。于是我将锅甩给 —— PHP 是世界上最好的语言。启用 Plan B</p>
<h2 class="xsj_heading_hash xsj_heading xsj_heading_h2" id="plan20b20nginx_3"><div class="xiaoshujiang_element xsj_anchor">
  <a name="plan20b20nginx_3" class="blank_anchor_name"></a><a id="plan20b20nginx_3" class="blank_anchor_id"></a><a name="plan-b-nginx" class="blank_anchor_name"></a><a id="plan-b-nginx" class="blank_anchor_id"></a>
</div>
<span class="xsj_heading_content">Plan B: nginx</span></h2>
<p class="xsj_paragraph xsj_paragraph_level_0">于是我打起了 nginx 的主意，nginx 挂载电影目录，然后直接作为 WebDAV 服务器提供服务。</p>
<p class="xsj_paragraph xsj_paragraph_level_0">为了让 nginx 能够支持 WebDAV 规范中的 PROPFIND 和 OPTIONS ，我们需要安装模块 <a href="https://github.com/arut/nginx-dav-ext-module" class="xsj_link xsj_manu_link">nginx-dav-ext-module</a> 。</p>
<p class="xsj_paragraph xsj_paragraph_level_0">然后在 configure 时，添加 --with-http_dav_module 和 --add-module=/path/to/nginx-dav-ext-module</p>
<p class="xsj_paragraph xsj_paragraph_level_0">并使用以下配置文件：</p>
<div class="xiaoshujiang_code_container"><div class="xiaoshujiang_pre"><div class="language-nginx hljs code_linenums xiaoshujiang_code"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;"><li class="li_linenum " date-linenum="1"><span class="li_linenum_before_span li_linenum_before_span_hide">1</span>    <span class="hljs-section">server</span> {<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="2"><span class="li_linenum_before_span li_linenum_before_span_hide">2</span>        <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl http2;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="3"><span class="li_linenum_before_span li_linenum_before_span_hide">3</span>        <span class="hljs-attribute">server_name</span> yourhostname.com;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="4"><span class="li_linenum_before_span li_linenum_before_span_hide">4</span>        <span class="hljs-attribute">ssl_certificate</span> <span class="hljs-string">"your cert"</span>;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="5"><span class="li_linenum_before_span li_linenum_before_span_hide">5</span>        <span class="hljs-attribute">ssl_certificate_key</span> <span class="hljs-string">"your cert key"</span>;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="6"><span class="li_linenum_before_span li_linenum_before_span_hide">6</span><span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="7"><span class="li_linenum_before_span li_linenum_before_span_hide">7</span>        <span class="hljs-attribute">client_max_body_size</span> <span class="hljs-number">102400M</span>;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="8"><span class="li_linenum_before_span li_linenum_before_span_hide">8</span><span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="9"><span class="li_linenum_before_span li_linenum_before_span_hide">9</span>        <span class="hljs-comment"># rewrite URL to allow create directory</span><span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="10"><span class="li_linenum_before_span li_linenum_before_span_hide">10</span>        <span class="hljs-attribute">location</span> / {<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="11"><span class="li_linenum_before_span li_linenum_before_span_hide">11</span><span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="12"><span class="li_linenum_before_span li_linenum_before_span_hide">12</span>            <span class="hljs-attribute">set</span> <span class="hljs-variable">$dest</span> <span class="hljs-variable">$http_destination</span>;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="13"><span class="li_linenum_before_span li_linenum_before_span_hide">13</span>            <span class="hljs-attribute">if</span> (-d <span class="hljs-variable">$request_filename</span>) {<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="14"><span class="li_linenum_before_span li_linenum_before_span_hide">14</span>                <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^(.*[^/])$</span> <span class="hljs-variable">$1</span>/;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="15"><span class="li_linenum_before_span li_linenum_before_span_hide">15</span>                <span class="hljs-attribute">set</span> <span class="hljs-variable">$dest</span> <span class="hljs-variable">$dest</span>/;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="16"><span class="li_linenum_before_span li_linenum_before_span_hide">16</span>            }<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="17"><span class="li_linenum_before_span li_linenum_before_span_hide">17</span>            <span class="hljs-attribute">if</span> (<span class="hljs-variable">$request_method</span> <span class="hljs-regexp">~ (MOVE|COPY))</span> {<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="18"><span class="li_linenum_before_span li_linenum_before_span_hide">18</span>                <span class="hljs-attribute">more_set_input_headers</span> <span class="hljs-string">'Destination: <span class="hljs-variable">$dest</span>'</span>;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="19"><span class="li_linenum_before_span li_linenum_before_span_hide">19</span>            }<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="20"><span class="li_linenum_before_span li_linenum_before_span_hide">20</span><span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="21"><span class="li_linenum_before_span li_linenum_before_span_hide">21</span>            <span class="hljs-attribute">if</span> (<span class="hljs-variable">$request_method</span> <span class="hljs-regexp">~ MKCOL)</span> {<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="22"><span class="li_linenum_before_span li_linenum_before_span_hide">22</span>                <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^(.*[^/])$</span> <span class="hljs-variable">$1</span>/ <span class="hljs-literal">break</span>;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="23"><span class="li_linenum_before_span li_linenum_before_span_hide">23</span>            }<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="24"><span class="li_linenum_before_span li_linenum_before_span_hide">24</span><span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="25"><span class="li_linenum_before_span li_linenum_before_span_hide">25</span>            <span class="hljs-attribute">dav_methods</span> PUT DELETE MKCOL COPY MOVE;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="26"><span class="li_linenum_before_span li_linenum_before_span_hide">26</span>            <span class="hljs-attribute">dav_ext_methods</span> PROPFIND OPTIONS;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="27"><span class="li_linenum_before_span li_linenum_before_span_hide">27</span>            <span class="hljs-attribute">dav_access</span> user:rw;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="28"><span class="li_linenum_before_span li_linenum_before_span_hide">28</span>            <span class="hljs-attribute">create_full_put_path</span>  <span class="hljs-literal">on</span>;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="29"><span class="li_linenum_before_span li_linenum_before_span_hide">29</span>            <span class="hljs-attribute">root</span> /webdav;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="30"><span class="li_linenum_before_span li_linenum_before_span_hide">30</span><span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="31"><span class="li_linenum_before_span li_linenum_before_span_hide">31</span>            <span class="hljs-attribute">auth_basic</span> <span class="hljs-string">"Restricted access"</span>;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="32"><span class="li_linenum_before_span li_linenum_before_span_hide">32</span>            <span class="hljs-attribute">auth_basic_user_file</span> /etc/nginx/htpasswd.conf;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="33"><span class="li_linenum_before_span li_linenum_before_span_hide">33</span>        }<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="34"><span class="li_linenum_before_span li_linenum_before_span_hide">34</span>    }<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li></ol></div></div></div>
<p class="xsj_paragraph xsj_paragraph_level_0">该配置开启了 HTTPS ，因为 HTTP2 需要开启 SSL。因此需要设置域名的证书和密钥。同时为了保证安全性，还设置了密码认证，密码文件通过 <code>htpasswd</code> 工具生成。</p>
<p class="xsj_paragraph xsj_paragraph_level_0">而：</p>
<div class="xiaoshujiang_code_container"><div class="xiaoshujiang_pre"><div class="language-nginx hljs code_linenums xiaoshujiang_code"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;"><li class="li_linenum " date-linenum="1"><span class="li_linenum_before_span li_linenum_before_span_hide">1</span>            <span class="hljs-attribute">set</span> <span class="hljs-variable">$dest</span> <span class="hljs-variable">$http_destination</span>;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="2"><span class="li_linenum_before_span li_linenum_before_span_hide">2</span>            <span class="hljs-attribute">if</span> (-d <span class="hljs-variable">$request_filename</span>) {<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="3"><span class="li_linenum_before_span li_linenum_before_span_hide">3</span>                <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^(.*[^/])$</span> <span class="hljs-variable">$1</span>/;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="4"><span class="li_linenum_before_span li_linenum_before_span_hide">4</span>                <span class="hljs-attribute">set</span> <span class="hljs-variable">$dest</span> <span class="hljs-variable">$dest</span>/;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="5"><span class="li_linenum_before_span li_linenum_before_span_hide">5</span>            }<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="6"><span class="li_linenum_before_span li_linenum_before_span_hide">6</span>            <span class="hljs-attribute">if</span> (<span class="hljs-variable">$request_method</span> <span class="hljs-regexp">~ (MOVE|COPY))</span> {<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="7"><span class="li_linenum_before_span li_linenum_before_span_hide">7</span>                <span class="hljs-attribute">more_set_input_headers</span> <span class="hljs-string">'Destination: <span class="hljs-variable">$dest</span>'</span>;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="8"><span class="li_linenum_before_span li_linenum_before_span_hide">8</span>            }<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="9"><span class="li_linenum_before_span li_linenum_before_span_hide">9</span><span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="10"><span class="li_linenum_before_span li_linenum_before_span_hide">10</span>            <span class="hljs-attribute">if</span> (<span class="hljs-variable">$request_method</span> <span class="hljs-regexp">~ MKCOL)</span> {<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="11"><span class="li_linenum_before_span li_linenum_before_span_hide">11</span>                <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^(.*[^/])$</span> <span class="hljs-variable">$1</span>/ <span class="hljs-literal">break</span>;<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="12"><span class="li_linenum_before_span li_linenum_before_span_hide">12</span>            }<span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li></ol></div></div></div>
<p class="xsj_paragraph xsj_paragraph_level_0">处理的是某些 WebDAV 客户端(如 OS X 下的 ForkLift) 在 创建文件夹 / 复制文件夹 / 移动文件夹 失败的问题：</p>
<div class="xiaoshujiang_code_container"><div class="xiaoshujiang_pre"><div class="language-bash hljs code_linenums xiaoshujiang_code"><ol start="1" class="ol_linenums" style="counter-reset: lines 0;"><li class="li_linenum " date-linenum="1"><span class="li_linenum_before_span li_linenum_before_span_hide">1</span>2018/06/03 08:03:58 [error] 7<span class="hljs-comment">#7: *1 MKCOL can create a collection only, client: 8.8.8.8, server: yourhostname.com, request: "MKCOL /sp HTTP/2.0", host: "yourhostname.com"</span><span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="2"><span class="li_linenum_before_span li_linenum_before_span_hide">2</span><span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="3"><span class="li_linenum_before_span li_linenum_before_span_hide">3</span>2018/06/03 08:17:20 [error] 7<span class="hljs-comment">#7: *18 "/sp" is collection, client: 8.8.8.8, server: yourhostname.com, request: "MOVE /sp HTTP/2.0", host: "yourhostname.com"</span><span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li><li class="li_linenum " date-linenum="4"><span class="li_linenum_before_span li_linenum_before_span_hide">4</span><span style="user-select:none;display:none;">&nbsp;</span><br class="code_line_break_hack_br"><hr class="code_line_break_hack_hr code_line_break_hack" style="margin:0;border:0;border-top:0;border-bottom:0;"></li></ol></div></div></div>
<p class="xsj_paragraph xsj_paragraph_level_0">这是因为 nginx 创建的 WebDAV server 要求所有对文件夹的操作，路径结尾都要有斜杠 <code>/</code> 。而某些客户端在对文件夹进行操作时路径结尾没有斜杠 <code>/</code>，于是报错。</p>
<p class="xsj_paragraph xsj_paragraph_level_0">解决方法是 url rewrite，如果操作的是文件夹，则补上 <code>/</code>。</p>
<p class="xsj_paragraph xsj_paragraph_level_0">但对于 MOVE / COPY 操作，文件路径还会设置到 header 的 Destination 中，也需要 rewrite ，这需要借助 <a href="https://github.com/openresty/headers-more-nginx-module#more_set_input_headers" class="xsj_link xsj_manu_link">headers-more-nginx-module</a> 模块。需要在 configure 时，添加 <code>--add-module=/path/to/headers-more-nginx-module</code></p>
<p class="xsj_paragraph xsj_paragraph_level_0">修改后的 Dockerfile 可见 <a href="https://github.com/binss/docker-nginx-webdav" class="xsj_link xsj_auto_link">https://github.com/binss/docker-nginx-webdav</a> ，将它和它的 submodule clone 下来后 docker build 即可。</p>
<p class="xsj_paragraph xsj_paragraph_level_0">实测结果令我满意：播放 10G 大小的视频，同局域网下能够在 1 秒内加载和拖动，在教育网同校区内能够在 5 秒内加载和拖动。htop 查看 CPU，发现几乎毫无波动。</p>
</div>

</div></div></section><strong>Tagged with <span><style data-emotion-css="1it6e0j">.css-1it6e0j{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary,#33e);}.css-1it6e0j:hover{color:var(--theme-ui-colors-secondary,#119);}</style><a class="css-1it6e0j" href="/acorns/tags/文章">文章</a><span> | </span></span><span><a class="css-1it6e0j" href="/acorns/tags/转载">转载</a><span> | </span></span><span><a class="css-1it6e0j" href="/acorns/tags/技术">技术</a><span> | </span></span><span><a class="css-1it6e0j" href="/acorns/tags/nginx">nginx</a><span> | </span></span><span><a class="css-1it6e0j" href="/acorns/tags/webdav">webdav</a><span> | </span></span><span><a class="css-1it6e0j" href="/acorns/tags/docker">docker</a></span></strong><style data-emotion-css="k008qs">.css-k008qs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><div class="css-k008qs"><style data-emotion-css="1eziwv">.css-1eziwv{-webkit-flex:1;-ms-flex:1;flex:1;text-align:left;}</style><div class="css-1eziwv"><a class="css-1it6e0j" href="/acorns/startup/top-10-website-startup-directions"><h4 class="css-1tr4euk"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" style="vertical-align:sub" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path></svg>Previous</h4><span>2020-4-27 十大网站创业方向</span></a></div><style data-emotion-css="1bge839">.css-1bge839{-webkit-flex:1;-ms-flex:1;flex:1;text-align:right;}</style><div class="css-1bge839"><a class="css-1it6e0j" href="/acorns/tutorial/build-your-own-webdav"><h4 class="css-1tr4euk">Next<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" style="vertical-align:sub" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"></path></svg></h4><span>搭建个人 webdav 服务器</span></a></div></div></div></div></div><style data-emotion-css="lvzlb4">.css-lvzlb4{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:0;background-color:var(--theme-ui-colors-background,#fff);border-top:1px solid;width:100%;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:16px;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media screen and (min-width:650px){.css-lvzlb4{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}</style><style data-emotion-css="1t4nmqc">.css-1t4nmqc{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;z-index:0;background-color:var(--theme-ui-colors-background,#fff);border-top:1px solid;width:100%;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:16px;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media screen and (min-width:650px){.css-1t4nmqc{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}</style><div class="css-1t4nmqc"><style data-emotion-css="kfpyh1">.css-kfpyh1{font-size:20px;}@media screen and (min-width:650px){.css-kfpyh1{font-size:24px;}}</style><div class="css-kfpyh1"><span class="css-14uqj98">Time Flies, No Time for Nuts <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="css-11lk46i" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M422.625 18.28c-24.68.13-51.932 15.455-74.094 36.907 1.868 1.036 3.742 2.07 5.626 3.157 8.05 4.642 15.615 9.363 22.72 14.125 25.19-9.583 55.47-14.465 103.437-2.97-12.036-37.07-33.633-51.345-57.688-51.22zM237.78 40.22l28.97 94.25c12.57 6.443 24.827 13.41 36.813 20.843l-36.625-111.97c-8.476-1.68-16.657-2.662-24.563-3-1.54-.065-3.074-.108-4.594-.124zm-19.218 1.124c-1.602.206-3.202.427-4.78.687-8.815 1.454-17.338 3.755-25.595 6.876l15.688 58.625c13.62 4.75 26.922 10.064 39.906 15.907l-25.218-82.093zm69.875 7.593l40.157 122.876c15.922 11.124 31.32 23.128 46.25 35.906L325.906 64.374c-13.092-6.527-25.568-11.643-37.47-15.438zm-117.5 7.844c-14.657 7.857-28.523 18.348-41.875 31.095 18.42 3.334 36.298 7.632 53.657 12.813L170.937 56.78zm179.25 20.907l53.282 155.97c10.798 10.382 21.322 21.187 31.624 32.374.395-1.174.75-2.332 1.125-3.5L379.843 97.407c-8.84-6.63-18.706-13.185-29.656-19.72zM136.595 108.25c-17.05 11.436-32.43 27.876-45.344 50.22-42.303 73.19-61.83 198.325-24.53 265.717l-.064-.062c.752 23.392-7.597 45.63-17.812 67.594 27.268-12.192 54.897-17.815 82.687-20.783l-.468-.343c87.895 19.01 212.87-49.42 260.688-132.156 13.547-23.44 20.606-46.14 22.28-67.72-77.218-81.572-166.868-139.912-277.436-162.468zm271.469 14L444.188 228c2.638-20.573.96-39.855-5.688-58.25-5.856-16.202-15.717-32.01-30.438-47.5z"></path></svg></span></div><style data-emotion-css="7ipau9">.css-7ipau9{font-family:oswald,sans-serif;font-size:14px;text-align:center;}@media screen and (min-width:650px){.css-7ipau9{font-size:16px;text-align:right;}}</style><div class="css-7ipau9"><div>Copyright © 2020 <!-- -->suziwen</div><div>Build with  <style data-emotion-css="ksfbmy">.css-ksfbmy{color:var(--theme-ui-colors-primary,#33e);}.css-ksfbmy:hover{color:var(--theme-ui-colors-secondary,#119);}</style><a href="https://www.gatsbyjs.com/" target="_blank" rel="noopener noreferrer" class="css-ksfbmy">Gatsbyjs</a>  and  <a href="https://www.github.com/suziwen/gatsby-theme-sculpting" target="_blank" rel="noopener noreferrer" class="css-ksfbmy">Sculpting</a> theme</div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script src="/acorns/libs/zoom/zoom-vanilla.min.js"></script><script>
                  var _hmt = _hmt || [];
                  (function() {
                      var hm = document.createElement("script");
                      hm.src = "//hm.baidu.com/hm.js?c02140dc523f5a309a2717a9a2bac552";
                      var s = document.getElementsByTagName("script")[0]; 
                      s.parentNode.insertBefore(hm, s);
                  })();
              </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/tutorial/build-webdav-server-by-nginx";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-73dabbe27fe47f1f504b.js"],"component---node-modules-suziwen-gatsby-theme-sculpting-src-pages-404-js":["/component---node-modules-suziwen-gatsby-theme-sculpting-src-pages-404-js-88c549ea4e1baab0b3d5.js"],"component---node-modules-suziwen-gatsby-theme-sculpting-src-pages-search-js":["/component---node-modules-suziwen-gatsby-theme-sculpting-src-pages-search-js-ffb07c446e1b00ed4999.js"],"component---node-modules-suziwen-gatsby-theme-sculpting-src-templates-template-archive-js":["/component---node-modules-suziwen-gatsby-theme-sculpting-src-templates-template-archive-js-5d317f573f75a6d14456.js"],"component---node-modules-suziwen-gatsby-theme-sculpting-src-templates-template-blog-list-js":["/component---node-modules-suziwen-gatsby-theme-sculpting-src-templates-template-blog-list-js-88b767e95770ade7676d.js"],"component---node-modules-suziwen-gatsby-theme-sculpting-src-templates-template-blog-post-js":["/component---node-modules-suziwen-gatsby-theme-sculpting-src-templates-template-blog-post-js-efe95cdbe0c15f8f04a1.js"],"component---node-modules-suziwen-gatsby-theme-sculpting-src-templates-template-tag-js":["/component---node-modules-suziwen-gatsby-theme-sculpting-src-templates-template-tag-js-bfea3c6f26076bfc9902.js"]};/*]]>*/</script><script src="/acorns/component---node-modules-suziwen-gatsby-theme-sculpting-src-templates-template-blog-post-js-efe95cdbe0c15f8f04a1.js" async=""></script><script src="/acorns/d24d3e064b601c3fa92397aa9f8c5e3fc3365436-1a38155e33e59d63a824.js" async=""></script><script src="/acorns/05d954cf-3cfd4b2627b9300c6035.js" async=""></script><script src="/acorns/41aca86e-fc6b3df334857d3ab071.js" async=""></script><script src="/acorns/29107295-617a57dac527a4bc3132.js" async=""></script><script src="/acorns/app-73dabbe27fe47f1f504b.js" async=""></script><script src="/acorns/252f366e-8a7faab70619996ad0cc.js" async=""></script><script src="/acorns/545f34e4-6ab32e105d05a4b785ff.js" async=""></script><script src="/acorns/framework-4b6e6fca25677e0206fe.js" async=""></script><script src="/acorns/webpack-runtime-0e44276faebbbc1fe6ef.js" async=""></script></body></html>